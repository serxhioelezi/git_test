import{r as e}from"./vendor.react.js";import{I as t,E as s}from"./userflow.js";import{u as o,i as r}from"./client-context.js";import{o as n}from"./vendor.obj-str.js";import{u as a,a as l,D as i}from"./stylesheets.js";import{a as m}from"./vendor.fortawesome.pro-regular-svg-icons.js";import{S as d,b as c,R as u,B as f}from"./bubble-frame.styl.js";import{f as b,b as E}from"./flow-condition-types.js";import{w as j,f as p}from"./flow-host.styl.js";import{u as g}from"./use-selector-element-monitoring.js";import{r as w}from"./vendor.react-dom.js";import{F as y}from"./use-window-resize.js";import{u as v}from"./use-element-rect.js";import"./vendor.object-assign.js";import"./vendor.phoenix.js";import"./vendor.uuid.js";import"./vendor.i18next.js";import"./vendor.react-i18next.js";import"./vendor.babel.runtime.js";import"./vendor.fortawesome.pro-solid-svg-icons.js";import"./vendor.date-fns.js";import"./vendor.scheduler.js";const h=({session:h})=>{const L=o(),{version:S}=h,T=S.banner,k=a(S.theme),N=h.locale?h.locale.standardLocaleId:h.version.theme.languageId;e.useEffect((()=>{r.changeLanguage(N)}),[N]);const M=e.useMemo((()=>document.createElement("div")),[]),[R,x]=e.useState(!1),{loaded:A}=l(window,p,k),[B,_]=e.useState(!1),C=A&&B,[F,I]=e.useState(0),D=e.useCallback((()=>{_(!1),I((e=>e+1))}),[]),O=![t.BODY_FIRST,t.BODY_LAST].includes(T.embedMode),[$,W]=e.useState(null),Y=e.useCallback((({targetEl:e})=>{W(e)}),[]),z=e.useCallback((()=>{O&&console.warn(`Userflow.js: Could not find embed element for banner "${h.flow.name||h.flow.id}"`),W(null)}),[O,h.flow.name,h.flow.id]);g({selector:T.embedSelector,targetMoved:Y,targetLost:z});const P=e.useCallback((()=>{M.parentElement?.removeChild(M),x(!1),D()}),[M,D]);e.useLayoutEffect((()=>{let e=null,s=null;if(O){if(!$)return void P();if(T.overlay||T.sticky){s=T.embedMode===t.ELEMENT_BEFORE||T.embedMode===t.ELEMENT_AFTER?$.parentElement:$;"static"===window.getComputedStyle(s).position&&(e=s.style.position,s.style.position="relative")}}switch(T.embedMode){case t.BODY_FIRST:document.body.insertAdjacentElement("afterbegin",M);break;case t.BODY_LAST:document.body.insertAdjacentElement("beforeend",M);break;case t.ELEMENT_FIRST:$.insertAdjacentElement("afterbegin",M);break;case t.ELEMENT_LAST:$.insertAdjacentElement("beforeend",M);break;case t.ELEMENT_BEFORE:$.insertAdjacentElement("beforebegin",M);break;case t.ELEMENT_AFTER:$.insertAdjacentElement("afterend",M)}return x(!0),D(),()=>{s&&null!=e&&(s.style.position=e)}}),[P,M,O,$,T.overlay,T.sticky,T.embedMode,D]),e.useLayoutEffect((()=>P),[P]);const U=n({"userflowjs-banner":!0,[`userflowjs-banner--animate-${String(T.animate)}`]:!0,[`userflowjs-banner--embed-mode-${T.embedMode}`]:!0,[`userflowjs-banner--sticky-${String(T.sticky)}`]:!0,[`userflowjs-banner--overlay-${T.overlay}`]:!0});e.useLayoutEffect((()=>{M.className=U||""}),[M,U]);const q=T.zIndex||j(0);e.useLayoutEffect((()=>{M.style.zIndex=null==q?"":String(q),M.style.position=C?"":"absolute",M.style.visibility=C?"":"hidden"}),[M,q,C]);const{height:G,setEl:H}=v();return e.useLayoutEffect((()=>{M.style.setProperty("--userflowjs-banner-height",b(G+(T.marginTop||0)+(T.marginBottom||0))||"")}),[M,G,T.marginTop,T.marginBottom]),R?w.createPortal(e.createElement(d.Provider,{value:h},e.createElement(y,{key:F,className:"userflowjs-banner-frame",style:{maxWidth:b(T.maxWidth),marginTop:b(T.marginTop),marginRight:b(T.marginRight),marginBottom:b(T.marginBottom),marginLeft:b(T.marginLeft),borderRadius:b(T.borderRadius)},stylesheet:c,theme:k,onStylesheetsLoad:_},e.createElement("div",{ref:H,className:n({"userflowjs-banner-root":!0,[`userflowjs-banner-root--content-layout-${T.contentLayout}`]:!0,"userflowjs-theme-root":!0}),dir:r.dir()},e.createElement("div",{className:"userflowjs-banner-start-spacer"}),e.createElement("div",{className:"userflowjs-banner-inner",style:{maxWidth:b(T.maxContentWidth)}},e.createElement("div",{className:"userflowjs-banner-content"},e.createElement(u,{doc:T.content,lookupAttribute:E(h.data)})),T.buttons.length>0&&e.createElement("div",{className:"userflowjs-banner-buttons"},T.buttons.map((t=>e.createElement(f,{key:t.id,button:t}))))),S.closeDisabled?e.createElement("div",{className:"userflowjs-banner-start-spacer"}):e.createElement("button",{"data-testid":"userflow-banner-dismiss",className:"userflowjs-banner-close",onClick:()=>L.endFlow(h,{endReason:s.USER_CLOSED})},e.createElement(i,{icon:m}))))),M):null};export default h;export{h as BannerApp};
