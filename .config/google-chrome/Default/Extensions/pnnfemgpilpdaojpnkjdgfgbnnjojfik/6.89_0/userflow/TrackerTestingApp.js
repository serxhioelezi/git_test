import{r as e}from"./vendor.react.js";import{u as t}from"./client-context.js";import{B as r}from"./BuilderBar.js";import{c as o}from"./flow-condition-types.js";import{y as s}from"./userflow.js";import"./vendor.object-assign.js";import"./vendor.i18next.js";import"./vendor.react-i18next.js";import"./vendor.babel.runtime.js";import"./use-window-resize.js";import"./vendor.react-dom.js";import"./vendor.scheduler.js";import"./stylesheets.js";import"./vendor.fortawesome.pro-regular-svg-icons.js";import"./vendor.fortawesome.pro-solid-svg-icons.js";import"./logomark.js";import"./vendor.obj-str.js";import"./vendor.fortawesome.pro-light-svg-icons.js";import"./vendor.date-fns.js";import"./vendor.phoenix.js";import"./vendor.uuid.js";const n=({state:n})=>{const i=t(),[a,c]=e.useState("notIdentified");e.useEffect((()=>{let e,t,r=!1;const a=async()=>{c("trackerLoading");const{tracker:e}=await i.send({kind:"GetTrackerForTesting",token:n.token});if(r)return;const{condition:a}=e,d=o[a.type];let l=!1;t=d.track({sessionData:new s(e.data),condition:a,flipBackEvents:!0,callback:e=>{const t=l;l=e,!t&&e&&i.setSessionStorageState((e=>({...e,trackerTesting:{...e.trackerTesting,events:e.trackerTesting.events+1}})))}}),c("trackerLoaded")};return e=()=>{i.off("private:identified",e),a()},i.isIdentified()?e():i.on("private:identified",e),()=>{r=!0,e&&i.off("private:identified",e),t&&t()}}),[i,n.token]);const d=e.useCallback((async()=>{i.setSessionStorageState((e=>({...e,activeApp:null,trackerTesting:null}))),i.getTargetEnv().postBuilderMessage({kind:"userflow:testTrackerClosed"})}),[i]);return e.createElement(r,{buttons:e.createElement("button",{className:"btn btn--default",onClick:()=>d()},"Back to Builder")},e.createElement("div",null,e.createElement("div",{className:"label"},"Testing tracker: ",n.trackerName),"notIdentified"===a?e.createElement("div",null,"Waiting for your app to identify user..."):"trackerLoading"===a?e.createElement("div",null,"Loading tracker..."):0===n.events?e.createElement("div",{className:"error"},"Not tracked yet"):e.createElement("div",{className:"success"},"Tracked ",n.events," time",1===n.events?"":"s")))};export default n;export{n as TrackerTestingApp};
