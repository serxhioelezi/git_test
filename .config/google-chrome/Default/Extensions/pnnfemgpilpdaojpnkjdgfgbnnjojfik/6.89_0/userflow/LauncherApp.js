import{r as e}from"./vendor.react.js";import{P as t,Q as r,W as o,L as s,X as n,Y as a,Z as c,O as i}from"./userflow.js";import{u as l,r as u}from"./use-selector-element-monitoring.js";import{m as E,d,S as p,R as m,h as T}from"./bubble-frame.styl.js";import{u as f,i as h}from"./client-context.js";import{o as w}from"./vendor.obj-str.js";import{a as g,c as C,g as v,D as R,u as b}from"./stylesheets.js";import{w as L,L as j,f as A,S as O}from"./flow-host.styl.js";import{F as N}from"./FlowChrome.js";import{B as _}from"./BubbleToolbar.js";import{b as k,r as I}from"./flow-condition-types.js";import{T as H}from"./Trigger.js";import"./vendor.object-assign.js";import"./vendor.phoenix.js";import"./vendor.uuid.js";import"./vendor.fortawesome.pro-solid-svg-icons.js";import"./vendor.react-i18next.js";import"./vendor.babel.runtime.js";import"./vendor.i18next.js";import"./vendor.fortawesome.pro-regular-svg-icons.js";import"./use-window-resize.js";import"./vendor.react-dom.js";import"./vendor.scheduler.js";import"./logomark.js";import"./vendor.date-fns.js";const x=e.forwardRef((({appearance:r,icon:o,buttonText:s,theme:n,noAnimation:a,noFixed:c,onClick:i,onMouseEnter:l,onMouseLeave:u,noPointerEvents:E,zIndex:d},p)=>{const{loaded:m}=g(window,A,n),T=n&&r===t.BUTTON?n:null,{loaded:f}=C(window,T),h={"userflowjs-launcher":!0,"userflowjs-launcher--activate-on-click":!!i,"userflowjs-fixed-widget":!c},b={ref:p,style:{...v(n),zIndex:d||L(j),pointerEvents:E?"none":void 0},onClick:i,onMouseEnter:l,onMouseLeave:u};if(!m||!f)return null;switch(r){case t.BEACON:return e.createElement("div",{className:w({...h,"userflowjs-beacon":!0,"userflowjs-beacon--pulse":!a,"userflowjs-beacon--pulse-still":!!a}),...b},e.createElement("div",{className:"userflowjs-beacon__ring"}),e.createElement("div",{className:"userflowjs-beacon__ring"}));case t.BUTTON:return e.createElement("div",{className:w({...h,"userflowjs-launcher--button":!0}),...b},s);case t.HIDDEN:return null;case t.ICON:return e.createElement("div",{className:w({...h,"userflowjs-launcher--icon":!0}),...b},e.createElement(R,{icon:o||"solid/info-circle",size:n.launcherIconSize}))}})),M=({session:w,active:g})=>{const C=f(),{version:v}=w,R=w.id,L=w.flow.id,j=w.version.launcher,[A,M]=e.useState(null),G=b(v.theme),U=w.locale?w.locale.standardLocaleId:G.languageId;e.useEffect((()=>{h.changeLanguage(U)}),[U]);const{activateOn:P}=j,y=j.activeWhileTooltipHover||j.buttons.length>0,B=j.hiddenWhileActive&&P!==r.LAUNCHER_HOVER,K=!g||!B,D=P===r.LAUNCHER_CLICK||P===r.TARGET_CLICK||P===r.LAUNCHER_TARGET_CLICK||y,F=e.useRef({}),S=e.useCallback((()=>{let e=null;const{targetEl:r,clipEl:s,viewportClipRect:n}=F.current,i=A;let l;i&&(r&&s&&n&&(e=function({targetEl:e,subjectEl:t,clipEl:r,viewportClipRect:s,position:n,subjectAnchor:i}){const l=I(e);if(0===l.width||0===l.height)return null;const u=t.getBoundingClientRect();let E=0,d=0,{side:p,align:m}=n;p===o.AUTO&&(p=o.TOP,m=a.END);switch(p){case o.TOP:d=l.top;break;case o.BOTTOM:d=l.bottom;break;case o.LEFT:E=l.left;break;case o.RIGHT:E=l.right}switch(p){case o.TOP:case o.BOTTOM:switch(m){case a.START:E=l.left;break;case a.CENTER:E=l.left+l.width/2;break;case a.END:E=l.right}break;case o.LEFT:case o.RIGHT:switch(m){case a.START:d=l.top;break;case a.CENTER:d=l.top+l.height/2;break;case a.END:d=l.bottom}}n.xUnit===c.PERCENT?E+=n.xOffset/100*l.width:E+=n.xOffset;n.yUnit===c.PERCENT?d+=n.yOffset/100*l.height:d+=n.yOffset;switch(i){case"center":E-=u.width/2,d-=u.height/2;break;case"side":switch(p){case o.TOP:d-=u.height;break;case o.LEFT:E-=u.width}switch(p){case o.TOP:case o.BOTTOM:switch(m){case a.CENTER:E-=u.width/2;break;case a.END:E-=u.width}break;case o.LEFT:case o.RIGHT:switch(m){case a.CENTER:d-=u.height/2;break;case a.END:d-=u.height}}}if(E+u.width<s.left||E>s.right)return null;if(d+u.height<s.top||d>s.bottom)return null;const T=I(r);return E=Math.max(E,T.left-r.scrollLeft),d=Math.max(d,T.top-r.scrollTop),E=Math.round(E),d=Math.round(d),{left:E,top:d}}({targetEl:r,subjectEl:i,clipEl:s,viewportClipRect:n,position:j.targetPosition,subjectAnchor:j.appearance===t.BEACON?"center":"side"})),u((()=>{!function(e,t){e.classList.toggle("userflowjs-fixed-widget--visible",null!=t),t&&(e.style.transform=`translate3d(${t.left}px, ${t.top}px, 0)`)}(i,e)}))),l=j.appearance===t.HIDDEN?!!r:!!e,!l||F.current.seenTriggered||R||(F.current.seenTriggered=!0,C.launcherSeen(L))}),[A,j,C,R,L]);e.useLayoutEffect((()=>{S()}),[S]);const z=e.useRef(!1),V=e.useRef(!1),W=e.useRef(!1),$=e.useRef(),Q=()=>{X();$.current=window.setTimeout((()=>Z.current()),250)},X=e.useCallback((()=>{window.clearTimeout($.current)}),[]),Y=()=>{if(P===r.LAUNCHER_CLICK||P===r.TARGET_CLICK||P===r.LAUNCHER_TARGET_CLICK)return;const e=P===r.LAUNCHER_HOVER||P===r.LAUNCHER_TARGET_HOVER,t=P===r.TARGET_HOVER||P===r.LAUNCHER_TARGET_HOVER;z.current&&(!B||!g)&&e||V.current&&t||W.current&&y?q():J()},Z=e.useRef(Y);Z.current=Y;const q=()=>{g||(X(),T(C,w,j.actions),j.tooltipEnabled?C.activateLauncher(w):(C.activateLauncher(w),C.deactivateLauncher(w)))},J=e.useCallback((()=>{g&&(X(),C.deactivateLauncher(w))}),[g,C,w,X]),ee=()=>{g?J():q()},te=e.useCallback((({targetEl:e,clipEl:t,viewportClipRect:r})=>{F.current.targetEl=e,F.current.clipEl=t,F.current.viewportClipRect=r,S()}),[S]),re=e.useCallback((()=>{F.current.targetEl=void 0,F.current.clipEl=void 0,S(),J()}),[S,J]);l({selector:j.targetSelector,targetMoved:te,targetLost:re,onTargetMouseEnter:()=>{V.current=!0,Q()},onTargetMouseLeave:()=>{V.current=!1,Q()},onTargetClick:P===r.TARGET_CLICK||P===r.LAUNCHER_TARGET_CLICK?ee:void 0}),e.useEffect((()=>{if(!g)return;const e=e=>{const t=e.target;A&&A.contains(t)||(P===r.TARGET_CLICK||P===r.LAUNCHER_TARGET_CLICK)&&F.current.targetEl&&F.current.targetEl.contains(t)||J()};return window.addEventListener("click",e,{capture:!0}),()=>window.removeEventListener("click",e,{capture:!0})}),[g,P,A,J]);const oe=function(e){switch(e.side){case o.AUTO:return null;case o.TOP:return i.ABOVE;case o.BOTTOM:return i.BELOW;case o.LEFT:return i.LEFT;case o.RIGHT:return i.RIGHT}}(j.tooltipPosition.side===o.AUTO?j.targetPosition:j.tooltipPosition),se=e.useMemo((()=>j.content&&E(d(j.content),{buttons:j.buttons})),[j.content,j.buttons]);return e.createElement(p.Provider,{value:w},K&&e.createElement(x,{ref:M,appearance:j.appearance,icon:j.icon,buttonText:j.buttonText,theme:G,onClick:P===r.LAUNCHER_CLICK||P===r.LAUNCHER_TARGET_CLICK?ee:void 0,onMouseEnter:()=>{z.current=!0,Q()},onMouseLeave:()=>{z.current=!1,Q()},noPointerEvents:P===r.TARGET_HOVER,zIndex:j.zIndex}),g&&e.createElement(O,null,e.createElement(N,{company:w.flow.company,theme:G,position:"fixed",stepAppearance:s.TOOLTIP,width:j.tooltipWidth,tooltipSelector:j.tooltipAnchor===n.TARGET?F.current.targetEl:A,tooltipPlacement:oe,frameWrapperHtmlAttributes:{onMouseEnter:()=>{W.current=!0,Q()},onMouseLeave:()=>{W.current=!1,Q()}},rootChildren:()=>e.createElement(e.Fragment,null,j.triggers.map((t=>e.createElement(H,{key:t.id,trigger:t}))))},e.createElement(_,{draftMode:w.draftMode,close:D?J:void 0}),e.createElement("div",{className:"userflowjs-bubble-content"},e.createElement(m,{doc:se,lookupAttribute:k(w.data),buttons:j.buttons})))))};export default M;export{M as LauncherApp};
