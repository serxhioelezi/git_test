import{r as e}from"./vendor.react.js";import{N as t,D as s,L as o,j as i}from"./userflow.js";import{F as n}from"./FlowChrome.js";import{i as r,u as c}from"./client-context.js";import{f as l,w as a,C as u,S as m}from"./flow-host.styl.js";import{a as d,D as h,u as p}from"./stylesheets.js";import{F as f}from"./use-window-resize.js";import{o as k}from"./vendor.obj-str.js";import{z as b}from"./flow-condition-types.js";import{C as v}from"./vendor.fortawesome.pro-regular-svg-icons.js";import{u as j}from"./vendor.react-i18next.js";import{C as E}from"./ChecklistUI.js";import{B as x}from"./BubbleToolbar.js";import"./vendor.object-assign.js";import"./vendor.phoenix.js";import"./vendor.uuid.js";import"./bubble-frame.styl.js";import"./vendor.fortawesome.pro-solid-svg-icons.js";import"./logomark.js";import"./use-selector-element-monitoring.js";import"./vendor.i18next.js";import"./vendor.react-dom.js";import"./vendor.scheduler.js";import"./vendor.date-fns.js";import"./vendor.babel.runtime.js";var w=new URL("checklist-launcher-frame.css",import.meta.url).href;const g=({position:s,theme:o,onClick:i,onVisibleChange:n,buttonRef:r,text:c,uncompletedCount:m})=>{const p=s||"absolute",{i18n:E}=j(),x=E.dir(),{loaded:g}=d(window,l,o),[y,L]=e.useState(!1),C=g&&y;e.useEffect((()=>{n&&n(C)}),[n,C]);const F=e.useRef(null),I=e.useRef(0),[A,T]=e.useState(null);e.useLayoutEffect((()=>{const e=F.current;if(!e||!A)return;const t=A.clientWidth;t!==I.current&&(I.current=t,e.style.setProperty("width",b(t)+"px","important"),e.style.setProperty("height",o.checklistLauncherHeight+"px","important"))}));const R=o.checklistLauncherPlacement,N=R===t.TOP_LEFT||R===t.TOP_RIGHT,S=R===t.TOP_LEFT||R===t.BOTTOM_LEFT,P={zIndex:"fixed"===p?null!=o.checklistZIndex?o.checklistZIndex:a(u):1,top:N?o.checklistLauncherY+"px":void 0,bottom:N?void 0:o.checklistLauncherY+"px",["ltr"===x?"left":"right"]:S?o.checklistLauncherX+"px":void 0,["ltr"===x?"right":"left"]:S?void 0:o.checklistLauncherX+"px",height:o.checklistLauncherHeight+"px",borderRadius:o.checklistLauncherBorderRadius+"px",position:C?void 0:"absolute",visibility:C?void 0:"hidden",animation:C?void 0:"none"};return e.createElement(f,{elRef:F,testId:"checklist-launcher-app",className:k({"userflowjs-checklist-launcher":!0,[`userflowjs-checklist-launcher--position-${p}`]:!0}),style:P,stylesheet:w,theme:o,onStylesheetsLoad:L},e.createElement("button",{ref:r,className:"userflowjs-checklist-launcher-frame-root",onClick:i},e.createElement("div",{ref:T,className:"userflowjs-checklist-launcher-content"},e.createElement("div",{className:"userflowjs-checklist-launcher-text"},c||"Get Started"),e.createElement("div",{"data-testid":"checklist-launcher-uncompleted-count",className:"userflowjs-checklist-launcher-uncompleted-count"},0===m?e.createElement(h,{icon:v}):m,e.createElement("div",{className:"userflowjs-a11y-only"},"uncompleted tasks")))))},y=({session:t,checklistExpanded:s})=>{const{version:o}=t,i=o.checklist,n=t.locale?t.locale.standardLocaleId:t.version.theme.languageId;e.useEffect((()=>{r.changeLanguage(n)}),[n]);const[c,l]=e.useState(!1);return s?e.createElement(L,{session:t,initialAutoFocus:c,setInitialAutoFocus:l}):i.launcherEnabled?e.createElement(C,{session:t,initialAutoFocus:c,setInitialAutoFocus:l}):null},L=({session:t,initialAutoFocus:i,setInitialAutoFocus:r})=>{const l=c(),[a,u]=e.useState(null),{version:d}=t,h=d.checklist,f=p(d.theme),k=e.useMemo((()=>({...f,avatarType:s.NONE,bubblePlacement:f.checklistPlacement,bubbleX:f.checklistX,bubbleY:f.checklistY,bubbleWidth:f.checklistWidth})),[f]);return e.useEffect((()=>{const e=a?.ownerDocument.defaultView;if(!e)return;const t=e=>{"Escape"===e.key&&(r(!0),l.hideChecklist())};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}),[a,r,l]),e.createElement(m,null,e.createElement(n,{company:t.flow.company,theme:k,position:"fixed",stepAppearance:o.BUBBLE,zIndex:f.checklistZIndex,autoHide3pEnabled:!0,backgroundImageUrl:h.backgroundAsset&&h.backgroundAsset.assetUrl,bubbleFrameRootRef:u},e.createElement("div",{role:"dialog","aria-label":"Checklist"},e.createElement(E,{session:t,initialAutoFocus:i}),e.createElement(x,{draftMode:t.draftMode,minimize:e=>{r(0===e.detail),l.hideChecklist()}}))))},C=({session:t,initialAutoFocus:s,setInitialAutoFocus:o})=>{const n=c(),[r,l]=e.useState(!1),[a,u]=e.useState(null),{version:m}=t,d=m.checklist,h=p(m.theme);return e.useEffect((()=>{r&&a&&s&&a.focus()}),[n,a,r,s]),e.createElement(g,{position:"fixed",theme:h,onClick:e=>{o(0===e.detail),n.showChecklist()},onVisibleChange:l,buttonRef:u,text:d.launcherText,uncompletedCount:i(t)})};export default y;export{y as ChecklistApp};
