import{h as e,C as t,c as n,i as r,j as s,k as o,l as c,E as a,m as l,n as i,p as u,S as d,A as m,q as f,_ as w}from"./userflow.js";import{r as h}from"./vendor.react.js";import{u as b,i as E}from"./client-context.js";import{u as k,w as v,f as p,C as g}from"./flow-host.styl.js";import{S as C,b as j,R as N,h as S,s as y,a as I,n as _}from"./bubble-frame.styl.js";import{M as x,g as T,a as M,b as R}from"./flow-condition-types.js";import{D as A,u as L,a as B,g as H}from"./stylesheets.js";import{u as O,F}from"./use-window-resize.js";import{o as P}from"./vendor.obj-str.js";import{S as D}from"./logomark.js";import{f as U,C as W}from"./ChecklistUI.js";import{f as $,a as z,b as q,c as V,d as K,e as G,g as Q,h as Z,i as J,j as Y,k as X}from"./vendor.fortawesome.pro-regular-svg-icons.js";import{B as ee}from"./BubbleToolbar.js";import{u as te}from"./use-element-rect.js";import{u as ne}from"./vendor.react-i18next.js";function re(t){return t!==e.ACTION&&t!==e.ANNOUNCEMENTS&&t!==e.ASSISTANT&&t!==e.CONTACT&&t!==e.FLOWS&&t!==e.KNOWLEDGE_BASE&&t!==e.SUBPAGE}const se=window,oe={[t.CRISP]:{configure:({onShow:e,onHide:t})=>{!function(){if(ce)return;ce=!0,se.$crisp||(se.$crisp=[]);se.$crisp.push(["do","chat:hide"])}();let n=!1,r=!1;const s=()=>{n||r?(se.$crisp.push(["do","chat:show"]),e()):(se.$crisp.push(["do","chat:hide"]),t())},o=()=>{n=!0,s()};se.$crisp.push(["on","chat:opened",o]);const c=()=>{n=!1,s()};se.$crisp.push(["on","chat:closed",c]);const a=()=>{r=!0,s()};se.$crisp.push(["on","message:received",a]);const l=window.setInterval((()=>{const e=(()=>{const e=document.getElementById("crisp-chatbox");if(!e||"block"!==window.getComputedStyle(e).display)return!1;const t=e.querySelector('[data-id="new_messages"]');return!(!t||"block"!==window.getComputedStyle(t).display)})();e!==r&&(r=e,s())}),200);return()=>{se.$crisp.push(["off","chat:opened",o]),se.$crisp.push(["off","chat:closed",c]),se.$crisp.push(["off","message:received",a]),window.clearInterval(l)}},show:()=>{se.$crisp.push(["do","chat:show"]),se.$crisp.push(["do","chat:open"])},hide:()=>{se.$crisp.push(["do","chat:hide"]),se.$crisp.push(["do","chat:close"])}},[t.CUSTOM]:{configure:()=>()=>{},show:({block:e})=>{try{new Function('"use strict";\n'+e.chatCode)()}catch(t){console.error(`Userflow.js: Showing custom chat provider failed. Code: ${e.chatCode}`,t)}},hide:()=>{}},[t.FRESHCHAT]:{configure:({onShow:e,onHide:t})=>{if(!se.fcWidget)throw new Error("Freshchat is not installed");let n=!1,r=!1;const s=()=>{n||r?e():t()},o=()=>{n=!0,s()};se.fcWidget.on("widget:opened",o);const c=()=>{n=!1,s()};se.fcWidget.on("widget:closed",c);const a=()=>{const e=!!document.querySelector("#fc_frame.h-open-notify");e!==r&&(r=e,s())},l=window.setInterval(a,200);return se.fcWidget.on("unreadCount:notify",a),()=>{se.fcWidget.off("widget:opened",o),se.fcWidget.off("widget:closed",c),se.fcWidget.off("unreadCount:notify",a),window.clearInterval(l)}},show:()=>{se.fcWidget.open()},hide:()=>{se.fcWidget.close()}},[t.HELPSCOUT]:{configure:({onShow:e,onHide:t})=>{if(!se.Beacon)throw new Error("Help Scout is not installed");!function(){if(ae)return;ae=!0,ie()}();let n=!1,r=!1;const s=()=>{n||r?(le(),e()):(ie(),t())},o=()=>{n=!0,s()};se.Beacon("on","open",o),se.Beacon("info")?.status.isOpened&&o();const c=()=>{n=!1,s()};se.Beacon("on","close",c);const a=window.setInterval((()=>{const e=!!document.querySelector(".BeaconNotificationsFrame");e!==r&&(r=e,s())}),200);return()=>{se.Beacon("off","open",o),se.Beacon("off","close",c),window.clearInterval(a)}},show:()=>{le(),se.Beacon("open")},hide:()=>{ie(),se.Beacon("close")}},[t.HUBSPOT]:{configure:({onShow:e,onHide:t})=>{const n=()=>{const n=document.getElementById("hubspot-messages-iframe-container");if(!se.HubSpotConversations||!n)return;window.clearInterval(s),function(){if(ue)return;ue=!0,de?me():fe()}();let o=!1,c=!1;const a=()=>{o||c?(me(),e()):(fe(),t())},l=()=>{const e=!!document.querySelector("#hubspot-messages-iframe-container .hs-shadow-container.active");e!==o&&(o=e,a())},i=new x(l);i.observe(n,{attributes:!0,subtree:!0,attributeFilter:["class"]}),l();const u=({unreadCount:e})=>{const t=e>0;t!==c&&(c=t,a())};se.HubSpotConversations.on("unreadConversationCountChanged",u),r=()=>{i.disconnect(),se.HubSpotConversations.off("unreadConversationCountChanged",u)}};let r=()=>{window.clearInterval(s)};const s=window.setInterval(n,100);return n(),()=>{r()}},show:()=>{me(),se.HubSpotConversations.widget.open()},hide:()=>{fe(),se.HubSpotConversations.widget.close()}},[t.INTERCOM]:{configure:({onShow:e,onHide:t})=>{if(!se.Intercom)throw new Error("Intercom is not installed");return function(){if(we)return;we=!0,ke();let e=!1,t=!1;const n=()=>{Ee();for(const e of he)e()},r=()=>{ke();for(const e of be)e()},s=()=>{e||t?n():r()};se.Intercom("onShow",(()=>{e=!0,s()})),se.Intercom("onHide",(()=>{e=!1,s()}));const o=()=>{const e=!!document.querySelector('iframe[name="intercom-borderless-frame"], iframe[name="intercom-notifications-frame"]');t!==e&&(t=e,s())};se.Intercom("onUnreadCountChange",(()=>{o()})),window.setInterval(o,200)}(),he.add(e),be.add(t),()=>{he.delete(e),be.delete(t)}},show:()=>{Ee(),se.Intercom("show")},hide:()=>{ke(),se.Intercom("hide")}},[t.ZENDESK]:{configure:({onShow:e,onHide:t})=>{if(!se.zE)throw new Error("Zendesk is not installed");!function(){if(ve)return;ve=!0,se.zE("webWidget","hide"),se.zE("webWidget","close"),se.zE("webWidget:on","open",(()=>{for(const e of pe)e()})),se.zE("webWidget:on","close",(()=>{for(const e of ge)e()})),se.zE("webWidget:on","chat:unreadMessages",(e=>{for(const t of Ce)t(e)}))}();let n=!1,r=!1;const s=()=>{n||r?(se.zE("webWidget","show"),e()):(se.zE("webWidget","hide"),t())},o=()=>{n=!0,r=!1,s()};pe.add(o);const c=()=>{n=!1,r=!1,s()};ge.add(c);const a=e=>{const t=e>0;t!==r&&(r=t,s())};return Ce.add(a),()=>{pe.delete(o),ge.delete(c),Ce.delete(a)}},show:()=>{se.zE("webWidget","show"),se.zE("webWidget","open")},hide:()=>{se.zE("webWidget","hide"),se.zE("webWidget","close")}},[t.ZENDESK_MESSENGER]:{configure:({onShow:e,onHide:t})=>{if(!se.zE)throw new Error("Zendesk is not installed");let n=!1;const r=window.setInterval((()=>{const r=(()=>{const e=document.querySelector('iframe[title="Messaging window"]');return!!e&&"0px"!==window.getComputedStyle(e).height})();r!==n&&(n=r,n?e():t())}),200);return()=>{window.clearInterval(r)}},show:()=>{se.zE("messenger","open")},hide:()=>{se.zE("messenger","close")}}};let ce=!1;let ae=!1;function le(){se.Beacon("config",{display:{style:"icon"}})}function ie(){se.Beacon("config",{display:{style:"manual"}})}let ue=!1,de=!1;function me(){de=!0;document.getElementById("hubspot-messages-iframe-container")?.style.setProperty("visibility","visible","important")}function fe(){de=!1;document.getElementById("hubspot-messages-iframe-container")?.style.setProperty("visibility","hidden","important")}let we=!1,he=new Set,be=new Set;function Ee(){se.Intercom("update",{hide_default_launcher:!1,vertical_padding:20})}function ke(){se.Intercom("update",{hide_default_launcher:!0,vertical_padding:100})}let ve=!1,pe=new Set,ge=new Set,Ce=new Set;const je=e=>h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),h.createElement("path",{fill:"currentColor",d:"M24.049 79.74h36.003c8.185 0 15.985-6.621 17.43-14.814l6.091-34.556h3.997c8.149 0 13.645 6.63 12.2 14.815l-7.051 40C91.274 93.363 83.474 100 75.288 100h-40c-8.185 0-13.645-6.667-12.2-14.815l.96-5.444Z"}),h.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M12.437 69.63h40c8.148 0 15.978-6.637 17.422-14.815l7.052-40C78.355 6.63 72.896 0 64.711 0h-40C16.533 0 8.726 6.63 7.281 14.815l-7.052 40C-1.215 62.963 4.252 69.63 12.437 69.63Zm33.628-33.798c3.756-2.064 8.725-4.795 9.907-11.844C57.385 15.458 50.065 8.983 42.168 9c-7.452 0-12.771 3.195-17.508 8.892-.858 1.034-.884 2.45-.053 3.212l3.472 3.196c.847.767 2.25.589 3.176-.406 2.842-3.068 4.869-4.83 8.51-4.83 2.864 0 6.077 1.934 5.59 4.847-.37 2.223-2.292 3.334-5.4 5.001l-.28.151c-3.582 1.92-8.134 4.362-9.124 10.247l-.16.956c-.055.28-.05.571.014.85.065.278.188.538.362.76.173.222.391.4.639.522.247.121.518.183.79.18h6.744a2.709 2.709 0 0 0 1.712-.688c.481-.426.81-1.01.934-1.657l.095-.556c.266-1.582 2.101-2.59 4.384-3.845ZM32.837 59c3.552 0 6.955-3.034 7.58-6.769.63-3.729-1.742-6.763-5.293-6.763-3.552 0-6.934 3.028-7.58 6.763C26.9 55.966 29.286 59 32.837 59Z"})),Ne=({center:e,fadeIn:t})=>{const n=12;return h.createElement("div",{className:P({"userflowjs-spinner":!0,"userflowjs-spinner--center":!!e,"userflowjs-spinner--fade-in":!!t})},h.createElement("svg",{viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},h.createElement("circle",{className:"userflowjs-spinner__bg",fill:"none",cx:n,cy:n,r:10,style:{strokeWidth:"4px"}}),h.createElement("circle",{className:"userflowjs-spinner__fill",fill:"none",cx:n,cy:n,r:10,transform:"translate(12, 12) rotate(-90) translate(-12, -12)",style:{strokeWidth:"4px",strokeDasharray:20*Math.PI*.25+"px, 1000"}})))};function Se({message:e,skip:t}){const n=b(),[r,s]=h.useState(!0),[o,c]=h.useState(!1),[a,l]=h.useState(null),[i,u]=h.useState(null),[d,m]=h.useState(null),f=h.useRef(0),w=h.useRef(null),E=h.useRef((()=>{}));return h.useEffect((()=>{if(t)return;const r=JSON.stringify(e);if(r===w.current)return;w.current=r;const o=++f.current;let a,i;let d=!1;E.current=async(e,t)=>{if(!d){d=!0,c(!0);try{const r=e(a,i);i=r;const s=await n.send(r,{handlesRejection:!0});if(o!==f.current)return;a=t(a,s),l(a),m(null)}catch(r){if(o!==f.current)return;m(r)}finally{d=!1,c(!1)}}},(async()=>{s(!0);try{i=e;const t=await n.send(e,{handlesRejection:!0});if(o!==f.current)return;a=t,l(a),u(e),m(null)}catch(t){if(o!==f.current)return;m(t)}finally{s(!1)}})()}),[t,n,e]),{loading:r,loadingMore:o,data:a,messageForData:i,error:d,loadMore:E.current}}function ye(e,t){const[n,r]=h.useState(e),s=h.useRef(void 0),o=h.useCallback((e=>{window.clearTimeout(s.current),r(e),t(e)}),[t]),c=h.useCallback((e=>{window.clearTimeout(s.current),r(e),s.current=window.setTimeout((()=>{t(e)}),200)}),[t]);return h.useEffect((()=>()=>{window.clearTimeout(s.current)}),[]),[n,c,o]}const Ie=({textareaRef:e,value:t,onChange:n,onBlur:r,onKeyDown:s,onMouseDown:o,placeholder:c,disabled:a,readOnly:l,className:i,mirrorClassName:u,textareaClassName:d,children:m})=>{let f=t||c||"";return(""===f||f.endsWith("\n"))&&(f+=" "),i=i||"growing-textarea",u=u||i+"__mirror",h.createElement("div",{className:i},h.createElement("div",{className:u+" "+(d||"")},f),h.createElement("textarea",{ref:e,value:t,onChange:e=>n&&n(e.target.value),onBlur:r,onKeyDown:s,onMouseDown:o,placeholder:c,disabled:a,readOnly:l,className:d}),m)},_e=({textareaRef:e,value:t,onChange:n,onSubmit:r,placeholder:s,readOnly:o})=>{const c=()=>{r&&r()};return h.createElement("div",{className:"userflowjs-assistant-chat-input"},h.createElement(Ie,{textareaRef:e,className:"userflowjs-growing-textarea",mirrorClassName:"userflowjs-growing-textarea__mirror",textareaClassName:"userflowjs-textarea userflowjs-assistant-chat-input__textarea",placeholder:s,readOnly:o,value:t||"",onChange:n,onKeyDown:e=>{e.shiftKey||"Enter"!==e.key||(e.preventDefault(),c())}}),h.createElement("button",{"data-testid":"assistant-chat-input-submit",className:"userflowjs-assistant-chat-input__submit",onClick:()=>c()},h.createElement(A,{icon:$})))};function xe(e){return n.linkUrlDecorator?n.linkUrlDecorator(e):e}const Te=async()=>(await w((()=>import("./ResourceCenterAssistantChat.js")),[new URL("ResourceCenterAssistantChat.js",import.meta.url).toString(),new URL("vendor.react.js",import.meta.url).toString(),new URL("vendor.object-assign.js",import.meta.url).toString(),new URL("userflow.js",import.meta.url).toString(),new URL("vendor.phoenix.js",import.meta.url).toString(),new URL("vendor.uuid.js",import.meta.url).toString(),new URL("client-context.js",import.meta.url).toString(),new URL("vendor.i18next.js",import.meta.url).toString(),new URL("vendor.react-i18next.js",import.meta.url).toString(),new URL("vendor.babel.runtime.js",import.meta.url).toString(),new URL("vendor.fortawesome.pro-regular-svg-icons.js",import.meta.url).toString(),new URL("vendor.dompurify.js",import.meta.url).toString(),new URL("vendor.marked.js",import.meta.url).toString(),new URL("vendor.obj-str.js",import.meta.url).toString(),new URL("bubble-frame.styl.js",import.meta.url).toString(),new URL("flow-condition-types.js",import.meta.url).toString(),new URL("vendor.date-fns.js",import.meta.url).toString(),new URL("stylesheets.js",import.meta.url).toString(),new URL("vendor.fortawesome.pro-solid-svg-icons.js",import.meta.url).toString(),new URL("vendor.react-dom.js",import.meta.url).toString(),new URL("vendor.scheduler.js",import.meta.url).toString(),new URL("flow-host.styl.js",import.meta.url).toString(),new URL("use-window-resize.js",import.meta.url).toString(),new URL("logomark.js",import.meta.url).toString(),new URL("ChecklistUI.js",import.meta.url).toString(),new URL("BubbleToolbar.js",import.meta.url).toString(),new URL("use-element-rect.js",import.meta.url).toString()])).ResourceCenterAssistantChat,Me=({session:l,isOpen:i,flowSession:u,checklistSession:d})=>{const m=b(),{t:f}=ne(),{company:w}=l.flow,{version:N}=l,S=N.resourceCenter,y=L(N.theme),I=l.locale?l.locale.standardLocaleId:l.version.theme.languageId;h.useEffect((()=>{E.changeLanguage(I)}),[I]);const{loaded:_}=B(window,p,y),[R,W]=h.useState(!1),$=_&&R,[G,Q]=h.useState(T()),[Z,J]=h.useState(M()),Y=h.useCallback((()=>{Q(T()),J(M())}),[]);O(Y);const{zIndex:X,bringToFront:ee}=k(),[te,se]=h.useState(null),[ce,ae]=h.useState(null),[le,ie]=h.useState(null),ue=h.useRef(null),[de,me]=h.useState(null),[fe,we]=h.useState(null),[he,be]=h.useState(null),[Ee,ke]=h.useState(0),[ve,pe]=h.useState(0),ge=h.useCallback((()=>{ce&&ke(Math.round(ce.offsetWidth)),pe(Math.round((le?.offsetHeight||0)+(de?.offsetHeight||0)+(fe?.offsetHeight||0)+(he?.offsetHeight||0)))}),[ce,le,de,fe,he]);h.useLayoutEffect((()=>{if(!te||"function"!=typeof x)return;const e=new x((()=>{ge()}));return e.observe(te,{childList:!0,attributes:!0,subtree:!0}),()=>{e.disconnect()}}),[te,ge]),h.useLayoutEffect((()=>{ge()}));const[Ce,Ne]=h.useState(!1),Se=h.useRef(),ye=h.useCallback((()=>{Ne(!0),window.clearTimeout(Se.current),Se.current=window.setTimeout((()=>{Ne(!1)}),y.resourceCenterTransitionDuration)}),[y.resourceCenterTransitionDuration]);h.useEffect((()=>()=>{window.clearTimeout(Se.current)}),[]);const Ie=h.useCallback((()=>{ee(),ye(),m.openResourceCenter()}),[ee,m,ye]),_e=h.useCallback((()=>{ye(),m.closeResourceCenter()}),[m,ye]),[xe,Te]=h.useState(!1);h.useEffect((()=>{if(xe){if(!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))if(i){const e='button:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"]), input, textarea';let t=de?.querySelector(".userflowjs-assistant-chat-input textarea")||de?.querySelector(e)||le?.querySelector(e);if(t){const e=t.closest&&t.closest(".userflowjs-resource-center-checklist")||null;e?U(e):t.focus({preventScroll:!0})}}else ce?.focus({preventScroll:!0});Te(!1)}}),[xe,i,de,le,ce]),h.useEffect((()=>{const e=te?.ownerDocument.defaultView;if(!i||!e)return;const t=e=>{"Escape"===e.key&&(_e(),Te(!0))};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}),[i,te,Te,_e]);const[Me,Ae]=h.useState((()=>function(e,t){if(!t)return null;const n=JSON.parse(t);let r;n.blockCvid&&(r=e.version.resourceCenter?.blocks.find((e=>e.cvid===n.blockCvid)));if(!r&&"search"!==n.kind)return null;const s={kind:n.kind,block:r};switch(s.kind){case"announcementShow":s.announcementId=n.announcementId}return s}(l,r.getItem(`resourceCenterRoute:v1:${l.id}`)))),Oe=h.useCallback(((e,t)=>{Ae(e);const n=function(e){if(!e)return null;let t;"block"in e&&null!=e.block&&(t=e.block.cvid);const n={kind:e.kind,blockCvid:t};switch(e.kind){case"announcementShow":n.announcementId=e.announcementId}return JSON.stringify(n)}(e);n?r.setItem(`resourceCenterRoute:v1:${l.id}`,n):r.removeItem(`resourceCenterRoute:v1:${l.id}`),0===t?.detail&&Te(!0)}),[l.id]);h.useEffect((()=>{if(!l.draftMode)return;if(!Me||!("block"in Me)||!Me.block)return;const e=S.blocks.find((e=>e.cvid===Me.block.cvid));e?JSON.stringify(e)!==JSON.stringify(Me.block)&&Ae({...Me,block:e}):Ae(null),Me.block}),[l.draftMode,S,Me]);const Fe=h.useMemo((()=>S.blocks.filter((t=>!(t.type===e.CHECKLIST&&!d)&&((t.type!==e.DIVIDER||!y.resourceCenterAutoDividers)&&(!t.hiddenWhenFlowsActive||!t.hiddenWhenFlowsActive.some((e=>e===u?.flow.id||e===d?.flow.id))))))),[S,u,d,y.resourceCenterAutoDividers]),$e=h.useMemo((()=>Be(Fe)),[Fe]),ze=h.useMemo((()=>d&&S.blocks.some((t=>t.type===e.CHECKLIST))?s(d):0),[S,d]),Ve=h.useMemo((()=>S.blocks.find((t=>t.type===e.CONTACT&&t.chatEnabled&&t.chatProvider))),[S]),[Qe,Ze]=h.useState(!1),Je=h.useCallback((()=>{m.closeResourceCenter(),Ve&&Ve.chatProvider!==t.CUSTOM&&Ze(!0)}),[m,Ve]),Ye=h.useCallback((()=>{Ze(!1)}),[]),Xe=h.useCallback((()=>{if(Ve)try{oe[Ve.chatProvider].hide({block:Ve}),Ye()}catch(e){console.error(`Userflow.js: Error when hiding ${Ve.chatProvider}:`,e)}}),[Ve,Ye]);h.useEffect((()=>{if(!Ve)return;n.autoHide3pDisabled=!0;const e=oe[Ve.chatProvider];try{const t=e.configure({block:Ve,onShow:Je,onHide:Ye});return()=>{t()}}catch(t){return void console.error(`Userflow.js: Error when configuring ${Ve.chatProvider}:`,t)}}),[Ve,Je,Ye]),h.useEffect((()=>{i&&Xe()}),[Xe,i]);const nt=h.useMemo((()=>S.blocks.find((t=>t.type===e.ANNOUNCEMENTS))),[S]),rt=!!Me&&("search"===Me.kind||"flows"===Me.kind||"knowledgeBase"===Me.kind),st="assistant"===Me?.kind||"announcementList"===Me?.kind||"announcementShow"===Me?.kind,ot=Math.min(st?y.resourceCenterFullWidth:y.resourceCenterWidth,G-2*y.resourceCenterPaddingX),ct={zIndex:null!=y.resourceCenterZIndex?y.resourceCenterZIndex:i?X:v(g),position:$?void 0:"absolute",visibility:$&&!Qe?void 0:"hidden"},at={width:(i?ot:Ee)+"px",height:i?Math.min(rt?540:st?720:ve,Z-2*y.resourceCenterPaddingY,null==y.resourceCenterMaxHeight?Number.MAX_VALUE:y.resourceCenterMaxHeight)+"px":void 0},[lt,it]=h.useState(!1),ut=()=>{Ie(),Te(!0)},dt=y.resourceCenterDisplayChecklistProgress&&d&&ze>0?h.createElement("div",{"data-testid":"resource-center-launcher-badge",className:"userflowjs-resource-center-launcher-badge"},ze,h.createElement("div",{className:"userflowjs-a11y-only"},"uncompleted tasks")):null;let mt="",ft="";return y.resourceCenterLauncherTextMode===o.CHECKLIST_OVERRIDE&&d&&ze>0?mt=d.version.checklist?.launcherText||"Get Started":y.resourceCenterLauncherTextMode!==o.NONE&&(ft=S.buttonText),h.createElement(C.Provider,{value:l},h.createElement("div",{"data-testid":"resource-center-app",className:"userflowjs-resource-center-app userflowjs-theme-root",style:H(y),dir:E.dir()},h.createElement("div",{className:P({"userflowjs-resource-center":!0,"userflowjs-resource-center--fixed":!0,[`userflowjs-resource-center--placement-${y.resourceCenterPlacement.toLowerCase().replace(/_/g,"-")}`]:!0}),style:ct},h.createElement("div",{className:"userflowjs-resource-center-frame-wrapper",onMouseEnter:()=>it(!0),onMouseLeave:()=>it(!1)},h.createElement(F,{className:P({"userflowjs-resource-center-frame":!0,"userflowjs-resource-center-frame--animating":Ce,"userflowjs-resource-center-frame--open":i,"userflowjs-resource-center-frame--closed":!i}),style:at,stylesheet:j,theme:y,onStylesheetsLoad:W},$&&h.createElement(h.Fragment,null,h.createElement("div",{ref:se,className:P({"userflowjs-resource-center-frame-root":!0,[`userflowjs-resource-center-frame-root--placement-${y.resourceCenterPlacement.toLowerCase().replace(/_/g,"-")}`]:!0,"userflowjs-resource-center-frame-root--animating":Ce,"userflowjs-resource-center-frame-root--open":i,"userflowjs-resource-center-frame-root--closed":!i}),role:i?"dialog":void 0,"aria-label":i?S.headerText:void 0},h.createElement("div",{className:"userflowjs-resource-center-launcher-container"},h.createElement("button",{ref:ae,className:P({"userflowjs-resource-center-launcher-button":!0,"userflowjs-resource-center-launcher-button--hover":lt}),onClick:ut,"aria-label":`Open ${S.headerText}`},dt,mt&&h.createElement("div",{"data-testid":"resource-center-launcher-text",className:"userflowjs-resource-center-launcher-text"},mt),(dt||mt)&&h.createElement("div",{className:"userflowjs-resource-center-launcher-divider"}),ft&&h.createElement("div",{"data-testid":"resource-center-launcher-text",className:"userflowjs-resource-center-launcher-text"},ft),h.createElement("div",{className:"userflowjs-resource-center-launcher-icon"},y.resourceCenterLauncherIconType===c.PLAINTEXT?"?":h.createElement(je,null)))),h.createElement("div",{ref:ue,className:"userflowjs-resource-center-body",style:{width:ot+"px"}},h.createElement("div",{ref:me,className:P({"userflowjs-resource-center-body-content":!0,"userflowjs-resource-center-body-content--padding":"assistant"!==Me?.kind,"userflowjs-resource-center-body-content--same-background":y.sameBackground,"userflowjs-resource-center-body-content--with-made-with-userflow":w.resourceCenterBranding})},i&&h.createElement(h.Fragment,null,Me?"search"===Me.kind?h.createElement(Pe,{session:l,navigate:Oe}):"email"===Me.kind?h.createElement(De,{block:Me.block,session:l}):"phone"===Me.kind?h.createElement(Ue,{block:Me.block,session:l}):"flows"===Me.kind?h.createElement(We,{block:Me.block,initialQ:Me.initialQ,session:l,navigate:Oe}):"knowledgeBase"===Me.kind?h.createElement(qe,{block:Me.block,initialQ:Me.initialQ,session:l,bodyRef:ue}):"subpage"===Me.kind?h.createElement(Ke,{block:Me.block,session:l}):"announcementList"===Me.kind||"announcementShow"===Me.kind?h.createElement(Ge,{bodyRef:ue,session:l,route:Me,navigate:Oe}):"assistant"===Me.kind?h.createElement(et,{block:Me.block,initialUserContent:Me.initialUserContent,session:l,navigate:Oe,chatBlock:Ve,onChatShow:Je}):null:h.createElement(h.Fragment,null,Fe.map(((e,t)=>{const n=He[e.type],r=Fe[t+1];return n?h.createElement(h.Fragment,{key:e.id},h.createElement(n.View,{session:l,flowSession:u,checklistSession:d,block:e,navigate:Oe,onChatShow:Je}),r&&function(e,t,n){return!!e.resourceCenterAutoDividers&&(re(t)||re(n))}(y,e.type,r.type)&&h.createElement("div",{className:"userflowjs-resource-center-divider"})):null})))))),w.resourceCenterBranding&&h.createElement("div",{className:"userflowjs-resource-center-made-with-userflow"},h.createElement("div",{className:"userflowjs-resource-center-made-with-userflow-content",ref:we},h.createElement("a",{href:"https://userflow.com/?utm_source=made-with-userflow&utm_medium=link&utm_campaign=made-with-userflow-"+w.slug+"&utm_content=resource-center",target:"_blank",rel:"noopener noreferrer"},h.createElement(D,null),h.createElement("div",null,"Made with Userflow")))),l.draftMode&&h.createElement("div",{className:"userflowjs-resource-center-preview"},h.createElement("div",{ref:be,className:"userflowjs-resource-center-preview-content"},h.createElement("div",{className:"userflowjs-resource-center-preview-text"},"Preview"),h.createElement("button",{className:"userflowjs-resource-center-preview-button",onClick:()=>{m.endFlow(l,{endReason:a.USER_CLOSED})}},h.createElement(A,{icon:z})))),h.createElement("div",{className:"userflowjs-resource-center-header",style:{width:ot+"px"}},h.createElement("div",{ref:ie,className:"userflowjs-resource-center-header-content"},null==Me?h.createElement("div",{className:"userflowjs-resource-center-header-text"},S.headerText):h.createElement("button",{className:"userflowjs-resource-center-icon-button",onClick:e=>Oe("announcementShow"===Me?.kind?{kind:"announcementList",block:Me.block}:null,e)},h.createElement("div",{className:"userflowjs-rtl-mirrored"},h.createElement(A,{icon:q})),h.createElement("div",{className:"userflowjs-resource-center-icon-button__text"},f("resource_center.back"))),h.createElement("div",{className:"flex-1"}),$e.length>0&&h.createElement("button",{className:"userflowjs-resource-center-icon-button",onClick:()=>{let e={kind:"search"};if(1===$e.length){const t=$e[0],n=He[t.type];n.routeTo&&(e=n.routeTo({block:t}))}"search"===Me?.kind?Oe(null):(tt(m,l,null,"Search icon"),Oe(e))},"aria-label":"Search"},h.createElement(A,{icon:V})),h.createElement("button",{className:"userflowjs-resource-center-icon-button userflowjs-resource-center-close-button",onClick:e=>{_e(),0===e.detail&&Te(!0)},"aria-label":`Close ${S.headerText}`},h.createElement(A,{icon:K}))))))),!i&&!u&&nt&&nt.unreadAnnouncementCount>0&&h.createElement(Re,{theme:y,count:nt.unreadAnnouncementCount,onClick:ut})),!i&&!u&&nt?.popoutAnnouncement&&h.createElement(Le,{session:l,open:Ie,navigate:Oe,theme:y,block:nt}))))},Re=({theme:e,count:t,onClick:n})=>{const[r,s]=h.useState(!1);return h.createElement(F,{className:P({"userflowjs-resource-center-launcher-unread-badge":!0}),noScroll:!0,style:{position:r?void 0:"absolute",visibility:r?void 0:"hidden"},stylesheet:j,theme:e,onStylesheetsLoad:s},h.createElement(Ae,{count:t,onClick:n}))},Ae=({count:e,onClick:t})=>{let n=null;return e>9&&(e=9,n=h.createElement("span",{className:"userflowjs-unread-badge-plus"},"+")),h.createElement("div",{className:P({"userflowjs-unread-badge":!0,"userflowjs-unread-badge--clickable":!!t}),onClick:t},h.createElement("span",null,e),n)},Le=({session:e,open:t,navigate:n,theme:r,block:s})=>{const o=s.popoutAnnouncement,c=b(),[a,l]=h.useState(!1),{height:i,setEl:u}=te(),d=h.useMemo((()=>CSS.supports("height: 100dvh")?"dvh":"vh"),[]);return h.createElement("div",{className:"userflowjs-resource-center-popout"},h.createElement(F,{className:P({"userflowjs-resource-center-popout-frame":!0}),style:{height:`calc(min(${i}px, 100${d} - 2 * var(--userflow-resource-center-padding-y) - var(--userflow-resource-center-collapsed-height) - 20px)`,position:a?void 0:"absolute",visibility:a?void 0:"hidden"},stylesheet:j,theme:r,onStylesheetsLoad:l},h.createElement("div",{ref:u,className:"userflowjs-resource-center-popout-frame-root"},h.createElement("h2",{className:"userflowjs-announcement-title"},h.createElement("span",{className:"userflowjs-unread-dot"}),h.createElement("span",null,o.title)),h.createElement("div",{className:"userflowjs-announcement-time"},h.createElement("div",{className:"userflowjs-announcement-time-text"},rt(o.time))),h.createElement("div",{className:"userflowjs-announcement-content userflowjs-bubble-content"},h.createElement(N,{doc:o.content,buttons:o.buttons})),o.moreEnabled&&h.createElement("div",{className:"userflowjs-announcement-more"},h.createElement("button",{className:"userflowjs-tertiary-button",onClick:()=>{Je(c,o),tt(c,e,s,o.title),n({kind:"announcementShow",block:s,announcementId:o.id}),t()}},h.createElement("div",null,(o.moreEnabled?o.moreButtonText:null)||"Read more"),h.createElement("span",{className:"userflowjs-rtl-mirrored"},h.createElement(A,{icon:G})))),h.createElement("div",{className:"userflowjs-bubble-toolbar"},h.createElement("button",{className:"userflowjs-bubble-toolbar-button",onClick:()=>{Je(c,o)},"aria-label":"Dismiss announcement"},h.createElement(A,{icon:z}))))),h.createElement("div",{className:"userflowjs-resource-center-popout-notch"}))};function Be(e){return e.filter((e=>{const t=He[e.type];return t.isSearchable?t.isSearchable(e):!!t.search}))}const He={[e.ACTION]:{View:e=>{const{block:t,session:n,flowSession:r,checklistSession:s}=e,o=b(),[c,a]=h.useState(!1),i=r?.id,u=s?.id;return h.useEffect((()=>{a(!1)}),[i,u]),h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:c?void 0:()=>{tt(o,n,t);const e=t.actions.find((e=>e.type===l.START_FLOW));if(e){e.otherFlow?.id!==s?.flow.id&&a(!0)}else o.closeResourceCenter();S(o,n,t.actions)},disabled:c},h.createElement(Oe,{...e}),h.createElement(Fe,{...e}),c&&h.createElement(Ne,null))}},[e.ANNOUNCEMENTS]:{View:e=>{const{block:t,session:n,navigate:r}=e,s=b();return h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:e=>{tt(s,n,t),r({kind:"announcementList",block:t},e)}},t.unreadAnnouncementCount>0?h.createElement("div",{className:"userflowjs-resource-center-block-icon"},h.createElement(Ae,{count:t.unreadAnnouncementCount})):h.createElement(Oe,{...e}),h.createElement(Fe,{...e}),h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q})))}},[e.ASSISTANT]:{View:e=>{const{block:t,session:n,navigate:r}=e,s=b(),[o,c]=h.useState("");return t.assistantAppearance===i.INPUT?h.createElement("div",{className:"userflowjs-resource-center-assistant-block"},h.createElement(_e,{value:o,onChange:c,placeholder:y(t.name,{lookupAttribute:R(n.data)}),onSubmit:()=>{tt(s,n,t),r({kind:"assistant",block:t,initialUserContent:o})}})):h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:()=>{tt(s,n,t),r({kind:"assistant",block:t,initialUserContent:""})}},h.createElement(Oe,{...e}),h.createElement(Fe,{...e}))}},[e.CHECKLIST]:{View:({checklistSession:e})=>h.createElement("div",{"data-testid":"resource-center-checklist",className:"userflowjs-resource-center-checklist"},h.createElement(W,{session:e}),h.createElement(ee,{draftMode:!!e.draftMode&&"CHECKLIST PREVIEW"}))},[e.CONTACT]:{View:e=>{const{block:t,session:n,navigate:r,onChatShow:s}=e,o=b(),c=[];return t.emailEnabled&&c.push({icon:J,label:"Email",isRoute:!0,onClick:e=>{tt(o,n,t,"Email"),r({kind:"email",block:t},e)}}),t.phoneEnabled&&c.push({icon:Y,label:"Phone",isRoute:!0,onClick:e=>{tt(o,n,t,"Phone"),r({kind:"phone",block:t},e)}}),t.chatEnabled&&c.push({icon:X,label:"Live-chat",isRoute:!1,onClick:()=>{tt(o,n,t,"Chat"),st(n,t,s)}}),h.createElement("div",{className:P({"userflowjs-resource-center-block":!0,"userflowjs-resource-center-block--clickable":1===c.length}),onClick:1===c.length?c[0].onClick:void 0},1===c.length&&h.createElement("div",{className:"userflowjs-resource-center-block-icon"},h.createElement(A,{icon:c[0].icon})),h.createElement(Fe,{...e}),c.length>1&&c.map((({icon:e,label:t,onClick:n},r)=>h.createElement("button",{key:r,className:"userflowjs-resource-center-icon-button",onClick:n,"aria-label":t},h.createElement(A,{icon:e})))),1===c.length&&c[0].isRoute&&h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q})))}},[e.DIVIDER]:{View:()=>h.createElement("div",{className:"userflowjs-resource-center-divider"})},[e.FLOWS]:{View:e=>{const{block:t,session:n,navigate:r}=e,s=b();return h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:e=>{tt(s,n,t),r({kind:"flows",block:t},e)}},h.createElement(Oe,{...e}),h.createElement(Fe,{...e}),h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q})))},routeTo:({block:e,initialQ:t})=>({kind:"flows",block:e,initialQ:t}),isSearchable:e=>!!e.searchEnabled,search:async({client:e,session:t,block:n,q:r})=>{const{flows:s}=await e.send({kind:"ListResourceCenterBlockFlows",sessionId:t.id,blockCvid:n.cvid},{handlesRejection:!0}),o=$e(s,r),c=o.slice(0,5);return{block:n,truncated:c.length===o.length,results:c.map((e=>({kind:"flow",flow:e})))}}},[e.KNOWLEDGE_BASE]:{View:e=>{const{block:t,session:n,navigate:r}=e,s=b();return h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:e=>{tt(s,n,t),r({kind:"knowledgeBase",block:t},e)}},h.createElement(Oe,{...e}),h.createElement(Fe,{...e}),h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q})))},routeTo:({block:e,initialQ:t})=>({kind:"knowledgeBase",block:e,initialQ:t}),search:async({client:e,session:t,block:n,q:r})=>{const{truncated:s,articles:o}=await e.send({kind:"SearchKnowledgeBase",sessionId:t.id,blockCvid:n.cvid,q:r,offset:0,limit:5},{handlesRejection:!0});return{block:n,truncated:s,results:o.map((e=>({kind:"article",article:e})))}}},[e.MESSAGE]:{View:({block:e,session:t})=>h.createElement("div",{className:"userflowjs-resource-center-block"},h.createElement("div",{className:"userflowjs-resource-center-block-text userflowjs-bubble-content"},h.createElement(N,{doc:e.content,lookupAttribute:R(t.data)})))},[e.SUBPAGE]:{View:e=>{const{block:t,session:n,navigate:r}=e,s=b();return h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:e=>{tt(s,n,t),r({kind:"subpage",block:t},e)}},h.createElement(Oe,{...e}),h.createElement(Fe,{...e}),h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q})))}}},Oe=({block:e})=>e.icon?h.createElement("div",{className:"userflowjs-resource-center-block-icon"},h.createElement(A,{icon:e.icon,size:16})):null,Fe=({block:e,session:t})=>h.createElement("div",{className:"userflowjs-resource-center-block-text"},h.createElement(I,{doc:e.name,lookupAttribute:R(t.data)}));const Pe=({session:e,navigate:t})=>{const n=b(),r=e.version.resourceCenter.blocks,s=Be(r),{t:o}=ne(),c=h.useRef(null),[a,l]=h.useState(""),[i,u]=ye(a,l),[d,m]=h.useState(null);return h.useEffect((()=>{if(""===a.trim())return void m(null);let t=!1;return(async()=>{m(null);const s=await Promise.all(r.map((async t=>{const{search:r}=He[t.type];if(!r)return null;try{return await r({client:n,session:e,block:t,q:a})}catch(s){return console.error(`Userflow.js: Global search failed for ${t.type} block=`,t,"error=",s),null}})));t||m(s.filter((e=>null!=e&&e.results.length>0)))})(),()=>{t=!0}}),[n,e,r,a]),h.useEffect((()=>{c.current?.focus({preventScroll:!0})}),[]),h.createElement(h.Fragment,null,h.createElement("div",{className:"userflowjs-resource-center-list-route-search"},h.createElement("input",{ref:c,className:"userflowjs-text-input",type:"text",value:i,onChange:e=>u(e.target.value),placeholder:o("resource_center.search_placeholder")})),""===a.trim()?h.createElement("div",{"data-testid":"resource-center-empty-query",className:"userflowjs-resource-center-list-route-error"},o("resource_center.search_in")," ",s.map(((t,n)=>h.createElement(h.Fragment,{key:t.cvid},n>0&&(n===s.length-1?` ${o("and")} `:", "),h.createElement("b",null,h.createElement(I,{doc:t.name,lookupAttribute:R(e.data)}))))),"."):d?0===d.length?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},o("resource_center.no_results_found")):d.map((({block:r,truncated:s,results:c},l)=>{const i=He[r.type],u=i.routeTo&&i.routeTo({block:r,initialQ:a});return h.createElement(h.Fragment,{key:r.cvid},l>0&&h.createElement("div",{className:"userflowjs-resource-center-divider"}),h.createElement("div",{className:"userflowjs-resource-center-label"},h.createElement(I,{doc:r.name,lookupAttribute:R(e.data)})),c.map(((n,s)=>"flow"===n.kind?h.createElement(ze,{key:n.flow.id,block:r,session:e,flow:n.flow,navigate:t}):"article"===n.kind?h.createElement(Ve,{key:s,block:r,session:e,article:n.article}):null)),!s&&u&&h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:s=>{tt(n,e,r),t(u,s)}},h.createElement("div",{className:"userflowjs-resource-center-block-text"},o("more"),":"," ",h.createElement(I,{doc:r.name,lookupAttribute:R(e.data)})),h.createElement("div",{className:"userflowjs-resource-center-block-nav-icon"},h.createElement(A,{icon:Q}))))})):h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null)))},De=({block:e,session:t})=>h.createElement("div",{className:"userflowjs-resource-center-content-route userflowjs-bubble-content"},h.createElement(N,{doc:e.emailContent,lookupAttribute:R(t.data)})),Ue=({block:e,session:t})=>h.createElement("div",{className:"userflowjs-resource-center-content-route userflowjs-bubble-content"},h.createElement(N,{doc:e.phoneContent,lookupAttribute:R(t.data)})),We=({block:e,initialQ:t,session:n,navigate:r})=>{const{t:s}=ne(),o=h.useRef(null),[c,a]=h.useState(t||""),[l,i]=ye(c,a),{data:u,error:d}=Se({message:{kind:"ListResourceCenterBlockFlows",sessionId:n.id,blockCvid:e.cvid}}),m=u?.flows,f=h.useMemo((()=>m?$e(m,c):null),[m,c]);return h.useEffect((()=>{o.current?.focus({preventScroll:!0})}),[]),h.createElement(h.Fragment,null,h.createElement("div",{className:"userflowjs-resource-center-list-route-header"},h.createElement("div",{className:"userflowjs-resource-center-list-route-title"},h.createElement(I,{doc:e.name,lookupAttribute:R(n.data)}))),e.searchEnabled&&h.createElement("div",{className:"userflowjs-resource-center-list-route-search"},h.createElement("input",{ref:o,className:"userflowjs-text-input",type:"text",value:l,onChange:e=>i(e.target.value),placeholder:s("resource_center.search_placeholder")})),d?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},s("resource_center.generic_error")):f?0===f.length?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},s("resource_center.no_results_found")):f.map((t=>h.createElement(ze,{key:t.id,block:e,session:n,flow:t,navigate:r}))):h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,{fadeIn:!0})))};function $e(e,t){const n=t.toLowerCase().trim();return""===n?e:e.filter((e=>e.name.toLowerCase().includes(n)))}const ze=({block:e,session:t,flow:n,navigate:r})=>{const s=b(),[o,c]=h.useState(!1);return h.useEffect((()=>{if(!o||n.type!==u.CHECKLIST)return;const e=()=>{s.checklistSession?.flow.id===n.id&&(t(),r(null))},t=()=>{s.off("checklistChanged",e)};return s.on("checklistChanged",e),t}),[s,o,n.type,n.id,r]),h.createElement("button",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:()=>{if(tt(s,t,e,n.name),s.checklistSession?.flow.id===n.id)return void r(null);s.startFlow({flowId:n.id,startReason:d.RESOURCE_CENTER,replaceCurrent:!0}),c(!0);const o=y(n.url,{lookupAttribute:R(t.data)});o&&_(o)},disabled:o},h.createElement("div",{className:"userflowjs-resource-center-block-icon"},h.createElement(A,{icon:n.type===u.CHECKLIST?"regular/tasks":"regular/shoe-prints",size:16})),h.createElement("div",{className:"userflowjs-resource-center-block-text"},n.name),o&&h.createElement(Ne,null))},qe=({block:e,initialQ:t,session:n,bodyRef:r})=>{const{t:s}=ne(),o=h.useRef(null),[c,a]=h.useState(t||""),[l,i]=ye(c,a),{loading:u,loadingMore:d,data:m,messageForData:f,error:w,loadMore:b}=Se({message:{kind:"SearchKnowledgeBase",sessionId:n.id,blockCvid:e.cvid,q:c,offset:0}});nt({bodyRef:r,loading:u,loadingMore:d,truncated:m?.truncated,loadMoreHelper:h.useCallback((()=>{b(((e,t)=>({...t,offset:e.articles.length})),((e,t)=>({...t,articles:[...e.articles,...t.articles]})))}),[b])}),h.useEffect((()=>{o.current?.focus({preventScroll:!0})}),[]);let E=e.knowledgeBaseUrl||"";return E.match(/^https?:\/\//)||(E=`http://${E}`),E=xe(E),h.createElement(h.Fragment,null,h.createElement("div",{className:"userflowjs-resource-center-list-route-header"},h.createElement("div",{className:"userflowjs-resource-center-list-route-title"},h.createElement(I,{doc:e.name,lookupAttribute:R(n.data)})),h.createElement("a",{className:"userflowjs-resource-center-icon-button",href:E,target:"_blank",rel:"noopener noreferrer"},h.createElement(A,{icon:Z}))),h.createElement("div",{className:"userflowjs-resource-center-list-route-search"},h.createElement("input",{ref:o,className:"userflowjs-text-input",type:"text",value:l,onChange:e=>i(e.target.value),placeholder:s("resource_center.search_placeholder")})),w?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},"quota_exceeded"===w.code?"Sorry, this company has reached its max number of searches. Consider asking Userflow to be moved to a dedicated search engine for a higher quota.":w.humanMessage||s("resource_center.generic_error")):u||!m?h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null)):0===m.articles.length?""===f?.q?null:h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},s("resource_center.no_results_found")):h.createElement(h.Fragment,null,""===f?.q&&h.createElement("div",{className:"userflowjs-resource-center-label"},s("resource_center.suggested_articles")),m.articles.map(((t,r)=>h.createElement(Ve,{key:r,block:e,session:n,article:t}))),d&&h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null))))},Ve=({block:e,article:t,session:n})=>{const r=b();return h.createElement("a",{className:"userflowjs-resource-center-block userflowjs-resource-center-block--clickable",onClick:()=>{tt(r,n,e,t.title)},href:xe(t.url),target:"_blank",rel:"noopener noreferrer"},h.createElement("div",{className:"userflowjs-resource-center-block-icon"},h.createElement(A,{icon:"regular/file-alt",size:16})),h.createElement("div",{className:"userflowjs-resource-center-block-text"},h.createElement("span",{dangerouslySetInnerHTML:{__html:t.htmlTitle}}),h.createElement("div",{className:"userflowjs-resource-center-block-subtext",dangerouslySetInnerHTML:{__html:t.htmlSnippet}})))},Ke=({block:e,session:t})=>h.createElement("div",{className:"userflowjs-resource-center-content-route userflowjs-bubble-content"},h.createElement(N,{doc:e.content,lookupAttribute:R(t.data)})),Ge=({bodyRef:e,session:t,route:n,navigate:r})=>{const s=b(),o=Se({message:{kind:"ListAnnouncements",beforeAnnouncementId:null},skip:"announcementList"!==n?.kind}),{loading:c,loadingMore:a,data:l,loadMore:i}=o,u=l?.truncated,d=h.useCallback((()=>{i(((e,t)=>e.announcements.length>0?{...t,beforeAnnouncementId:e.announcements[e.announcements.length-1].id}:t),((e,t)=>({...t,announcements:[...e.announcements,...t.announcements]})))}),[i]);nt({bodyRef:e,loading:c,loadingMore:a,truncated:u,loadMoreHelper:d});const[m,f]=h.useState(void 0);return h.useLayoutEffect((()=>{e.current&&null!=m&&"announcementList"===n?.kind&&(e.current.scrollTop=m)}),[e,m,n?.kind]),"announcementList"===n?.kind?h.createElement(Qe,{bodyRef:e,session:t,block:n.block,onMoreClick:o=>{f(e.current?.scrollTop),tt(s,t,n.block,o.title),r({kind:"announcementShow",block:n.block,announcementId:o.id})},...o}):"announcementShow"===n?.kind?h.createElement(Xe,{block:n.block,announcementId:n.announcementId}):null},Qe=({bodyRef:e,block:t,session:n,onMoreClick:r,error:s,loading:o,loadingMore:c,data:a})=>{const{t:l}=ne(),[i,u]=h.useMemo((()=>{const e=[],t=[];if(a){let n=-1;for(const r of a.announcements)n++,n<a.pageSize&&!r.seen&&r.level!==m.SILENT?e.push(r):t.push(r)}return[e,t]}),[a]),d=i.length;return h.createElement(h.Fragment,null,h.createElement("div",{className:"userflowjs-resource-center-list-route-header"},h.createElement("div",{className:"userflowjs-resource-center-list-route-title"},h.createElement(I,{doc:t.name,lookupAttribute:R(n.data)}))),s?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},s.humanMessage||l("resource_center.generic_error")):o||!a?h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null)):0===a.announcements.length?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},E.exists("resource_center.no_announcements",{fallbackLng:[]})?l("resource_center.no_announcements"):l("resource_center.no_results_found")):h.createElement(h.Fragment,null,d>0&&h.createElement("div",{className:"userflowjs-announcement-unread-header"},l("resource_center.unread",{count:d})),i.map(((t,n)=>h.createElement(Ye,{key:n,bodyRef:e,onMoreClick:()=>r(t),announcement:t}))),i.length>0&&u.length>0&&h.createElement("div",{className:"userflowjs-announcement-seen-divider"}),u.map(((t,n)=>h.createElement(Ye,{key:n,bodyRef:e,onMoreClick:()=>r(t),announcement:t}))),c&&h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null))))},Ze=new Set;function Je(t,n){Ze.has(n.id)||(Ze.add(n.id),t.setResourceCenterSession((t=>t?{...t,version:{...t.version,resourceCenter:{...t.version.resourceCenter,blocks:t.version.resourceCenter.blocks.map((t=>t.type===e.ANNOUNCEMENTS?{...t,unreadAnnouncementCount:t.unreadAnnouncementCount-1,popoutAnnouncement:t.popoutAnnouncement?.id===n.id?null:t.popoutAnnouncement}:t))}}}:null)),t.toggleUI(),t.send({kind:"MarkAnnouncementSeen",announcementId:n.id,versionId:n.versionId}))}const Ye=({bodyRef:e,onMoreClick:t,announcement:n})=>{const r=b(),s=h.useRef(null),o=h.useRef(!1);return h.useEffect((()=>{if(o.current||n.seen)return;const t=new IntersectionObserver((e=>{const t=e[0];t&&t.isIntersecting&&(Je(r,n),o.current=!0,c())}),{root:e.current,threshold:1}),c=()=>{t.disconnect()};return t.observe(s.current),c}),[e,r,n]),h.createElement("div",{className:"userflowjs-announcement-list-item"},h.createElement("div",{className:"userflowjs-announcement-time-divider"},h.createElement("div",{className:"userflowjs-announcement-time-divider-line"}),h.createElement("div",{className:"userflowjs-announcement-time-text"},rt(n.time)),h.createElement("div",{className:"userflowjs-announcement-time-divider-line"})),h.createElement("h2",{ref:s,className:"userflowjs-announcement-title"},!n.seen&&n.level!==m.SILENT&&h.createElement("span",{className:"userflowjs-unread-dot"}),h.createElement("span",null,n.title)),h.createElement("div",{className:"userflowjs-announcement-content userflowjs-bubble-content"},h.createElement(N,{doc:n.content,buttons:n.buttons})),h.createElement("div",{className:"userflowjs-announcement-more"},n.moreEnabled&&h.createElement("button",{className:"userflowjs-tertiary-button",onClick:t},h.createElement("div",null,n.moreButtonText||"Read more"),h.createElement("span",{className:"userflowjs-rtl-mirrored"},h.createElement(A,{icon:G})))))},Xe=({announcementId:e})=>{const t=b(),{t:n}=ne(),{loading:r,data:s,error:o}=Se({message:{kind:"GetAnnouncement",announcementId:e}}),c=s?.announcement;return h.useEffect((()=>{c&&!c.seen&&Je(t,c)}),[t,c]),h.createElement(h.Fragment,null,o?h.createElement("div",{className:"userflowjs-resource-center-list-route-error"},o.humanMessage||n("resource_center.generic_error")):r||!c?h.createElement("div",{className:"userflowjs-resource-center-list-route-spinner"},h.createElement(Ne,null)):h.createElement(h.Fragment,null,h.createElement("div",{className:"userflowjs-announcement-show"},h.createElement("h2",{className:"userflowjs-announcement-title"},c?.title),h.createElement("div",{className:"userflowjs-announcement-time"},h.createElement("div",{className:"userflowjs-announcement-time-text"},rt(c.time))),h.createElement("div",{className:"userflowjs-bubble-content"},h.createElement(N,{doc:c.content,buttons:c.buttons}),c.moreEnabled&&h.createElement(N,{doc:c.moreContent,buttons:c.moreButtons})))))},et=({block:t,initialUserContent:n,session:s,navigate:o,onChatShow:c})=>{const a=t.assistantFlowId,l=b(),[i,u]=h.useState(null),[d,m]=h.useState(null),[w,E]=h.useState(null),[k]=h.useState(n);h.useEffect((()=>{n&&o({kind:"assistant",block:t,initialUserContent:""})}),[n,t,o]),h.useEffect((()=>{let e=!1;return(async()=>{try{const t=r.getItem("assistantConversationId:"+a),[n,s]=await Promise.all([Te(),l.send({kind:"GetAssistant",assistantFlowId:a,conversationId:t},{handlesRejection:!0,endBatch:!0})]);if(e)return;u((()=>n)),m(s)}catch(t){console.error("Resource center assistant route failed to load:",t),E(t.humanMessage||"Sorry, something went wrong. Please try again or contact my human friends.")}})(),()=>{e=!0}}),[l,a]);const v=h.useMemo((()=>{if(!t.assistantContactEnabled)return;const n=s.version.resourceCenter?.blocks.find((t=>t.type===e.CONTACT));return n?()=>{switch(tt(l,s,t,t.assistantContactButtonText||void 0),t.assistantContactMethod){case f.EMAIL:o({kind:"email",block:n});break;case f.PHONE:o({kind:"phone",block:n});break;default:o(null),st(s,n,c)}}:void 0}),[l,s,t,c,o]);return w?h.createElement("div",{className:"userflowjs-assistant-chat"},h.createElement("div",{className:"userflowjs-assistant-chat__content"},h.createElement("div",{className:"userflowjs-assistant-chat__error"},w))):i&&d?h.createElement(i,{block:t,session:s,assistantReply:d,initialUserContent:k,onContactClick:v,contactButtonText:t.assistantContactButtonText||void 0}):h.createElement(Ne,{center:!0,fadeIn:!0})};function tt(e,t,n,r){e.send({kind:"ClickResourceCenter",sessionId:t.id,description:n?y(n.name,{lookupAttribute:R(t.data)})+(r?` - ${r}`:""):r},{batch:!0})}function nt({bodyRef:e,loading:t,loadingMore:n,truncated:r,loadMoreHelper:s}){h.useEffect((()=>{const o=e.current;if(!o||t||n||r)return;const c=()=>{o.scrollHeight-o.clientHeight-o.scrollTop>400||s()};return o.addEventListener("scroll",c),()=>{o.removeEventListener("scroll",c)}}),[e,t,n,r,s])}function rt(e){const t=e?new Date(e):new Date;let n=new Intl.DateTimeFormat(E.language,{weekday:"long",day:"numeric",month:"short",year:t.getFullYear()===(new Date).getFullYear()?void 0:"numeric"}).format(t);return n.substring(0,1).toUpperCase()+n.substring(1)}function st(e,t,n){if(t.chatProvider){const e=oe[t.chatProvider];try{e.show({block:t})}catch(r){console.error(`Userflow.js: Error when showing ${t.chatProvider}:`,r)}n()}else e.draftMode&&window.alert("You have not selected a chat provider. Go to the resource center builder in Userflow. Click the Contact block. Pick a chat provider in the side panel.")}var ot=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ResourceCenterApp:Me,default:Me});export{_e as A,Ie as G,ot as R,xe as d};
