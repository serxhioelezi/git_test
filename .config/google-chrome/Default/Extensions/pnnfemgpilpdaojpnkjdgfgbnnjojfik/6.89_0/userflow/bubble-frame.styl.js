import{r as e}from"./vendor.react.js";import{c as t,b as n,i as r,d as l}from"./flow-condition-types.js";import{b as a,D as o}from"./stylesheets.js";import{o as i}from"./vendor.obj-str.js";import{c as s,s as u,r as c,m as d,v as m,S as b,E as p,w as h,U as f,x as w,d as g}from"./userflow.js";import{f as v}from"./vendor.fortawesome.pro-solid-svg-icons.js";import{u as E}from"./vendor.react-i18next.js";import{u as y}from"./client-context.js";const k=e.createContext(null);function _(){const t=e.useContext(k);if(!t)throw new Error("useSession: Session was not set");return t}function x(n){const r=_(),[l,o]=e.useState(!1),i=a(r.data),s=function(t){const n=e.useRef(t),r=e.useRef(t);return t!==r.current&&JSON.stringify(t)!==JSON.stringify(r.current)&&(n.current=t),r.current=t,n.current}(n);return e.useLayoutEffect((()=>{if(s){return t[s.type].track({sessionData:i,condition:s,callback:e=>{o(e)}})}}),[i,s]),null!=s&&l}const j=({appearance:t,hidden:n,disabled:r,onMouseDown:l,onClick:a,text:o,active:s,children:u})=>e.createElement("button",{className:i({[se(t)]:!0,"userflowjs-bubble-button--hidden":!!n,"userflowjs-bubble-button--active":!!s}),onMouseDown:l,onClick:a,disabled:r},u||e.createElement("div",{className:"userflowjs-bubble-button-text",role:"presentation"},o));function q(e){const t=c();t!==new URL(e,t).toString()&&(s.customNavigate?s.customNavigate(e):window.setTimeout((()=>{u(e)}),0))}async function S(e,t,l){const{steps:a}=t.version;switch(l.type){case d.CLOSE_FLOW:switch(t.kind){case"launcher":await e.dismissLauncher(t,{endReason:p.ACTION});break;case"banner":case"flow":case"checklist":await e.endFlow(t,{endReason:p.ACTION})}return;case d.EVAL_JS:if(s.evalJsDisabled)return void console.error('Userflow.js: Blocked "Evaluate JavaScript" action from running, since userflow.disableEvalJs() has been called.');try{const e=r(l.code||"",t.data);new Function('"use strict";\n'+e)()}catch(o){console.error(`Userflow.js: Evaluate JavaScript action failed.\n\nError:\n${o.stack||o.message||o}\n\nCode:\n${l.code}`)}return;case d.GO_TO_STEP:{if("flow"!==t.kind)return;const n=a.find((({crossVersionId:e})=>e===l.stepCvid));if(!n)throw new f("Action points to unknown step: "+l.stepCvid);return void(await e.goToStep(t,n))}case d.NAVIGATE:{if(!l.url)return void console.warn("Userflow.js: NAVIGATE action is missing url property");const e=M(l.url,{lookupAttribute:n(t.data)});return void(l.navigateTarget===m.NEW_TAB?window.open(e):q(e))}case d.SET_ATTRIBUTE:{let t;const n=l.attributeValue||"";switch(l.attributeOperation){case h.SET:t={set:n};break;case h.SET_DATETIME:t={set:(new Date).toISOString()};break;case h.SET_DATETIME_ONCE:t={set_once:(new Date).toISOString()};break;case h.SET_ONCE:t={set_once:n};break;case h.ADD:t={add:n};break;case h.SUBTRACT:t={subtract:n};break;case h.APPEND:t={append:n};break;case h.PREPEND:t={prepend:n};break;case h.REMOVE:t={remove:n};break;case h.UNSET:t={set:null};break;default:return}const r=l.attributeFqn||"",a=r.split("/");return void(1===a.length?e.updateUser({[r]:t}):"group"===a[0]?e.updateGroup({[a[1]]:t}):"group_membership"===a[0]&&e.updateGroup({},{membership:{[a[1]]:t}}))}case d.SNOOZE:return void("flow"===t.kind&&l.timeValue&&l.timeUnit&&(e.endFlow(t,{endReason:p.SNOOZED,batch:!0}),t.draftMode?window.alert(`In preview mode, flows can't be snoozed.\n\nBut if this flow was running in published mode, the flow would now be snoozed for ${l.timeValue} ${l.timeUnit.toLowerCase()+(1===l.timeValue?"":"s")}.`):e.send({kind:"Snooze",flowId:t.flow.id,timeValue:l.timeValue,timeUnit:l.timeUnit},{batch:!0})));case d.START_FLOW:return"launcher"===t.kind&&e.deactivateLauncher(t),void(l.otherFlow?await e.startFlow({flowId:l.otherFlow.id,stepCvid:l.otherFlowStepCvid,startReason:t.draftMode?b.DRAFT:b.ACTION,replaceCurrent:!0}):console.warn("Userflow.js: START_FLOW action is missing other flow"))}}async function N(e,t,n){const r=[],l=[],a=[];for(const o of n)o.type===d.NAVIGATE?o.navigateTarget===m.NEW_TAB?r.push(o):a.push(o):l.push(o);for(const o of r)S(e,t,o);await Promise.all(l.map((n=>S(e,t,n))));for(const o of a)S(e,t,o)}const T=({button:t})=>{const n=y(),l=_(),a=x(t.disabledCondition),o=x(t.hiddenCondition);return e.createElement(j,{appearance:t.appearance,hidden:o,disabled:a,onClick:()=>N(n,l,t.actions),text:r(t.text,l.data)})},C=()=>e.createElement("svg",{viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg"},e.createElement("polygon",{className:"userflowjs-star-shape",fill:"#fff",points:"16 22.7785728 7.18322122 29.1352549 10.5042507 18.7856772 1.73415226 12.3647451 12.6034401 12.3250364 16 2 19.3965599 12.3250364 30.2658477 12.3647451 21.4957493 18.7856772 24.8167788 29.1352549"})),A=({type:t,required:n,placeholder:r,buttonText:l,options:a,otherOption:s,multipleSelection:u,shuffleOptions:c,labelLeft:d,labelCenter:m,labelRight:b,minValue:p,maxValue:h,onSubmit:f,inert:g})=>{const{t:y}=E(),k=e.useRef(null),[_,x]=e.useState(""),[j,q]=e.useState(new Set),[S,N]=e.useState(),[T,A]=e.useState(),[P,L]=e.useState(!1),[$,R]=e.useState(!1),[M,O]=e.useState(null),F=e.useMemo((()=>a&&(c?[...a].sort((()=>Math.random()-.5)):a)),[a,c]),U=e=>{if(!g&&f){if(n&&""===_&&[w.MULTILINE_TEXT,w.TEXT].includes(t))return O(y("question.requiredError")),void D();R(!0),O(null),f({...e,onCancel:()=>{R(!1)},onError:e=>{R(!1),O(e||"Sorry, something went wrong saving your answer. Please try again.")}})}},D=e.useCallback((()=>{!g&&k.current&&k.current.focus()}),[g]),[B,W]=e.useState(!1);e.useEffect((()=>{B&&(D(),W(!1))}),[D,B]);const V=e.createElement("div",{className:"userflowjs-bubble-buttons"},e.createElement("button",{className:"userflowjs-bubble-button userflowjs-bubble-button--primary",onClick:()=>U({answer:{kind:"text",value:_}}),tabIndex:g?-1:void 0,disabled:$},e.createElement("div",{className:"userflowjs-bubble-button-text",role:"presentation"},l||y("question.submit"))));let J=null,K=0;if(t===w.NPS)d=d||y("question.npsLabelLeft"),b=b||y("question.npsLabelRight"),J=[0,1,2,3,4,5,6,7,8,9,10],K=J.length;else if([w.SCALE,w.STARS].includes(t)){h=null!=h?h:5,J=[];for(let e=p=null!=p?p:1;e<=h;e++)J.push(e);K=J.length}else t===w.MULTIPLE_CHOICE&&(K=(F?F.length:0)+(s&&!P?1:0));const[z,G]=e.useState(-1),H=-1===z?-1:Math.min(z,K-1),X=e=>{if(!e.target.closest('[role="radio"], [role="checkbox"], [role="radiogroup"], [role="group"]'))return;let t=null;if("ArrowRight"===e.key||"ArrowDown"===e.key?t=1:"ArrowLeft"!==e.key&&"ArrowUp"!==e.key||(t=-1),null!=t){e.preventDefault();const n=e.currentTarget.querySelectorAll('[role="radio"], [role="checkbox"]');let r=H+t;r<0?r=n.length-1:r>n.length-1&&(r=0),G(r),n[r].focus()}};let Q,Z=null,Y=null;if(J&&(d||m||b)){const t=[];d&&t.push(J[0],d),b&&t.push(J[J.length-1],b),Z=e.createElement("div",{id:"a11y-scale-labels",className:"userflowjs-a11y-only"},t.join(", ")),Y=e.createElement("div",{id:"userflowjs-bubble-question-labels",className:"userflowjs-bubble-question__scale-labels","aria-hidden":"true"},e.createElement("div",{className:"userflowjs-bubble-question__scale-label"},d),m&&e.createElement("div",{className:"userflowjs-bubble-question__scale-label userflowjs-bubble-question__scale-label--center"},m),e.createElement("div",{className:"userflowjs-bubble-question__scale-label userflowjs-bubble-question__scale-label--right"},b))}switch(t){case w.MULTILINE_TEXT:Q=e.createElement(e.Fragment,null,e.createElement("textarea",{ref:k,className:"userflowjs-textarea userflowjs-bubble-question__textarea",value:_,onChange:e=>x(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&U({answer:{kind:"text",value:_}})},placeholder:r||y("question.placeholder"),readOnly:g||$,tabIndex:g?-1:void 0,rows:3,"aria-required":n?"true":void 0,"aria-invalid":null!=M?"true":void 0}),V);break;case w.MULTIPLE_CHOICE:{const t=()=>{_&&U({answer:{kind:"text",value:_},animationPromise:I()})},n=(F?.length||0)+(s?1:0),a=Math.max(0,Math.min(n,null==p?1:p)),c=Math.max(0,Math.min(n,null==h?n:h)),d=()=>{const e=(F||[]).filter(((e,t)=>j.has(t))).map((e=>e.value));s&&P&&""!==_&&e.push(_),a!==c||e.length===a?e.length<a?O(y("question.multiple_selection_too_few",{count:a})):e.length>c?O(y("question.multiple_selection_too_many",{count:c})):U({answer:{kind:"list",values:e}}):O(y("question.multiple_selection_wrong",{count:a}))};Q=e.createElement(e.Fragment,null,u&&e.createElement("div",{className:i({"userflowjs-bubble-question__multiple-choice-hint":!0,"userflowjs-bubble-question__multiple-choice-hint--error":!!M})},y("question.multiple_selection_hint",{replace:{selected:j.size+(s&&P&&""!==_?1:0),range:a===c?a:`${a}-${c}`}}),M&&e.createElement(e.Fragment,null,". ",e.createElement("span",{role:"alert"},M))),e.createElement("div",{className:i({"userflowjs-bubble-question__multiple-choice":!0,"userflowjs-bubble-question__multiple-choice--single-selection":!u,"userflowjs-bubble-question__multiple-choice--multiple-selection":!!u}),role:u?"group":"radiogroup",tabIndex:g||-1!==H?-1:0,onKeyDown:X},F?.map((({value:t,label:n},r)=>e.createElement("button",{key:r,className:i({"userflowjs-bubble-question__multiple-choice-option":!0,"userflowjs-bubble-question__multiple-choice-option--selected":u?j.has(r):$&&!P&&_==t}),onClick:$?void 0:()=>{if(u){O(null);const e=new Set(j);j.has(r)?e.delete(r):e.add(r),q(e)}else L(!1),x(t),U({answer:{kind:"text",value:t},animationPromise:I()})},disabled:$,tabIndex:g||r!==H?-1:0,role:u?"checkbox":"radio","aria-label":n||t,"aria-checked":!P&&_==t},u?e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox"},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox-inner"},e.createElement(o,{icon:v}))):e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio"},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio-inner"})),e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-option-text","aria-hidden":"true"},n||t)))),s&&(P?e.createElement("div",{className:i({"userflowjs-bubble-question__multiple-choice-option":!0,"userflowjs-bubble-question__multiple-choice-option--other":!0,"userflowjs-bubble-question__multiple-choice-option--selected":u?""!=_:$})},u?e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox",onClick:()=>{x(""),L(!1)}},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox-inner"},e.createElement(o,{icon:v}))):e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio"},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio-inner"})),e.createElement("input",{ref:k,className:"userflowjs-bubble-question__multiple-choice-option-input",value:_,onChange:e=>x(e.target.value),onKeyDown:e=>{e.shiftKey||"Enter"!==e.key?"Escape"===e.key&&(e.stopPropagation(),x(""),L(!1)):u?d():t()},onBlur:()=>{""===_&&L(!1)},placeholder:r||y("question.placeholder"),readOnly:g||$,tabIndex:g?-1:void 0}),!u&&e.createElement("button",{"data-testid":"multiple-choice-other-submit",className:"userflowjs-bubble-question__multiple-choice-option-submit",onClick:()=>t(),disabled:$,"aria-label":y("question.submit")},e.createElement(o,{icon:v}))):e.createElement("button",{className:"userflowjs-bubble-question__multiple-choice-option",onClick:$?void 0:()=>{O(null),L(!0),W(!0)},disabled:$,tabIndex:g||F?.length!==H?-1:0,role:"radio","aria-label":y("question.other"),"aria-checked":"false"},u?e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox"},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-checkbox-inner"},e.createElement(o,{icon:v}))):e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio"},e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-radio-inner"})),e.createElement("div",{className:"userflowjs-bubble-question__multiple-choice-option-text","aria-hidden":"true"},y("question.other"))))),u&&e.createElement("div",{className:"userflowjs-bubble-buttons"},e.createElement("button",{className:"userflowjs-bubble-button userflowjs-bubble-button--primary",onClick:d,tabIndex:g?-1:void 0,disabled:$},e.createElement("div",{className:"userflowjs-bubble-button-text",role:"presentation"},l||y("question.submit")))));break}case w.NPS:case w.SCALE:Q=e.createElement(e.Fragment,null,Z,e.createElement("div",{className:"userflowjs-bubble-question__scale-options",role:"radiogroup",tabIndex:g||-1!==H?-1:0,onKeyDown:X},J?.map(((t,n)=>e.createElement("button",{className:i({"userflowjs-bubble-question__scale-option":!0,"userflowjs-bubble-question__scale-option--selected":$&&S==t}),key:t,tabIndex:g||n!==H?-1:0,onClick:()=>{N(t),U({answer:{kind:"number",value:t},animationPromise:I()})},disabled:$,role:"radio","aria-checked":S==t},t)))),Y);break;case w.STARS:Q=e.createElement("div",{className:"userflowjs-bubble-question__stars-wrapper"},Z,e.createElement("div",{className:"userflowjs-bubble-question__stars",role:"radiogroup",tabIndex:g||-1!==H?-1:0,onKeyDown:X},J?.map(((t,n)=>e.createElement("button",{className:i({"userflowjs-bubble-question__star":!0,"userflowjs-bubble-question__star--hovered":!$&&null!=T&&T>=t,"userflowjs-bubble-question__star--selected":$&&null!=S&&S>=t,"userflowjs-bubble-question__star--not-selected":$&&null!=S&&S<t}),key:t,tabIndex:g||n!==H?-1:0,onClick:()=>{N(t),U({answer:{kind:"number",value:t},animationPromise:I()})},onMouseOver:()=>A(t),onMouseLeave:()=>A(null),disabled:$,role:"radio","aria-checked":S==t,"aria-label":String(t)},e.createElement("div",{className:"userflowjs-bubble-question__star-icon","aria-hidden":"true"},e.createElement(C,null)),e.createElement("div",{className:"userflowjs-bubble-question__star-value","aria-hidden":"true"},t))))),Y);break;case w.TEXT:Q=e.createElement(e.Fragment,null,e.createElement("input",{ref:k,className:"userflowjs-text-input userflowjs-bubble-question__text-input",value:_,onChange:e=>x(e.target.value),onKeyDown:e=>{e.shiftKey||"Enter"!==e.key||U({answer:{kind:"text",value:_}})},placeholder:r||y("question.placeholder"),readOnly:g||$,tabIndex:g?-1:void 0,"aria-required":n?"true":void 0,"aria-invalid":null!=M?"true":void 0}),V)}return e.createElement("div",{className:"userflowjs-bubble-question",style:{pointerEvents:g?"none":void 0}},M&&!(t===w.MULTIPLE_CHOICE&&u)&&e.createElement("div",{className:"userflowjs-bubble-question__error",role:"alert"},M),Q)};function I(){return new Promise((e=>window.setTimeout(e,250)))}const P=({question:t})=>{const n=y(),r=function(){const e=_();if("flow"!==e.kind)throw new Error("useFlowSession: Wrong session kind");return e}();return e.createElement(A,{type:t.type,required:!!t.required,placeholder:t.placeholder||"",buttonText:t.buttonText||"",options:t.options,otherOption:t.otherOption,multipleSelection:t.multipleSelection,shuffleOptions:t.shuffleOptions,labelLeft:t.labelLeft||"",labelCenter:t.labelCenter||"",labelRight:t.labelRight||"",minValue:t.minValue,maxValue:t.maxValue,onSubmit:async e=>{g("answerQuestion",r.id,t.cvid,e);const{answer:l}=e;try{await Promise.all([await n.send({kind:"AnswerQuestion",sessionId:r.id,questionName:t.name,questionCvid:t.cvid,textAnswer:"text"==l.kind?l.value:null,numberAnswer:"number"==l.kind?String(l.value):null,listAnswer:"list"==l.kind?l.values:null}),e.animationPromise])}catch(o){return console.log("Userflow.js: Error when answering question:",o),void e.onError()}const{bindAttributeFqn:a}=t;if(a&&n.flowSession?.id===r.id){let e;switch(l.kind){case"text":e={name:a,value:l.value};break;case"number":e={name:a,value:String(l.value)};break;case"list":e={name:a,value:l.values}}n.optimisticClockUIUpdate((()=>{n.setFlowSession({...r,data:[...r.data.filter((e=>e.name!==a)),e]})}))}N(n,r,t.actions)}})},L=({text:t})=>{if(!t)return null;const n=t.split(/\n/);return 1===n.length?e.createElement(e.Fragment,null,n[0]):e.createElement(e.Fragment,null,n.map(((t,n)=>e.createElement(e.Fragment,{key:n},n>0&&e.createElement("br",null),t))))};function $(e=""){return{type:"paragraph",children:[{text:e}]}}function R(e){if(e){let n;try{n=JSON.parse(e)}catch(t){throw new Error("Could not JSON.parse rich content doc: "+e)}if("rich2"===n.type)return n;throw new Error("Could not recognize rich content doc: "+e)}return function(e=""){return{type:"rich2",children:[$(e)]}}()}function M(e,{lookupAttribute:t}){if(!e)return"";"string"==typeof e&&(e=function(e){if(e){let n;try{n=JSON.parse(e)}catch(t){throw new Error("Could not JSON.parse plaintext doc: "+e)}if("plaintext2"===n.type)return n;throw new Error("Could not recognize plaintext doc: "+e)}return function(e=""){return{type:"plaintext2",children:[{type:"plaintext",children:[{text:e}]}]}}()}(e));const n=[];function r(e){e&&e.forEach((e=>e&&function(e){if(le(e))e.text&&n.push(e.text);else switch(e.type){case"attribute":{const r=te(e,t);r&&n.push(r);break}default:r(e.children)}}(e)))}return r(e.children),n.join("")}function O(e){let t=!0;if(!e)return!0;"string"==typeof e&&(e=R(e));const n=new Set(["attribute","button","image","question","video"]);return ae(e,(e=>{le(e)?""!==e.text&&(t=!1):"type"in e&&n.has(e.type)&&(t=!1)})),t}const F=e.memo((({doc:t,...n})=>t?("string"==typeof t&&(t=R(t)),e.createElement(U,{parent:t,...n})):null)),U=({parent:t,...n})=>e.createElement(e.Fragment,null,t.children.map(((r,l)=>le(r)?e.createElement(D,{key:l,node:r}):e.createElement(W,{key:l,node:r,parent:t,...n})))),D=({node:t})=>t.text?e.createElement(B,{node:t},e.createElement(L,{text:t.text})):null,B=({node:t,children:n})=>(t.color&&"string"==typeof t.color&&(n=e.createElement("span",{style:{color:t.color}},n)),t.bold&&(n=e.createElement("b",null,n)),t.italic&&(n=e.createElement("i",null,n)),t.underline&&(n=e.createElement("u",null,n)),t.strikeThrough&&(n=e.createElement("s",null,n)),t.code&&(n=e.createElement("code",null,n)),t.small&&(n=e.createElement("small",null,n)),t.sup&&(n=e.createElement("sup",null,n)),n),W=({node:t,parent:n,...r})=>{const{lookupAttribute:l}=r,a=e.createElement(U,{parent:t,...r});switch(t.type){case"attribute":return e.createElement(V,{node:t,...r});case"button":return e.createElement(J,{node:t,...r});case"button-group":return e.createElement("div",{className:"userflowjs-bubble-buttons",style:{justifyContent:t.align}},a);case"column":return e.createElement("div",{style:Y(t,n)},a);case"column-group":return e.createElement("div",{className:"p-like",style:Z(t)},a);case"container":return e.createElement("div",{className:"p-like"+(t.className?` ${t.className}`:""),style:ee(t)},a);case"image":return e.createElement(z,{node:t,...r});case"link":return e.createElement("a",{href:M(t.href,{lookupAttribute:l}),target:"same"===t.target?"_top":"_blank",rel:"noopener noreferrer"},a);case"paragraph":return e.createElement("p",{className:X(t)},a);case"heading1":return e.createElement("h1",{className:X(t)},a);case"heading2":return e.createElement("h2",{className:X(t)},a);case"question":return e.createElement(K,{node:t,...r});case"quote":return e.createElement("blockquote",null,a);case"code-block":return e.createElement("pre",null,e.createElement("code",null,a));case"ordered-list":return e.createElement("ol",null,a);case"unordered-list":return e.createElement("ul",null,a);case"list-item":return e.createElement("li",null,a);case"video":return e.createElement(G,{node:t,...r});default:return e.createElement("div",null,a)}},V=({node:t,lookupAttribute:n})=>{let r=te(t,n);return e.createElement(B,{node:t},r)},J=({node:t,buttons:n})=>{const r=n?.find((e=>e.cvid===t.cvid));return r?e.createElement(T,{key:r.id,button:r}):null},K=({node:t,questions:n})=>{const r=n?.find((e=>e.cvid===t.cvid));return r?e.createElement(P,{key:r.id,question:r}):null},z=({node:t,lookupAttribute:n})=>{const{src:r,widthMode:a,displayWidth:o,width:i,height:s,marginTop:u,marginRight:c,marginBottom:d,marginLeft:m,align:b,hasLink:p,href:h}=t;if("string"!=typeof r||!r)return null;const{wrapperStyle:f,blockStyle:w}=Q({widthMode:a,displayWidth:o,width:i,height:s,marginTop:u,marginRight:c,marginBottom:d,marginLeft:m,align:b});let g=e.createElement("img",{src:l(r,(e=>encodeURIComponent((n?n(e):"")||""))),style:{...w,objectFit:"contain"},alt:""});return p&&h&&(g=e.createElement("a",{href:M(h,{lookupAttribute:n}),target:"same"===t.target?"_top":"_blank",rel:"noopener noreferrer",style:w},g)),e.createElement("div",{className:"p-like"},e.createElement("div",{style:f},g))},G=({node:t,lookupAttribute:n})=>{const{url:r,widthMode:l,displayWidth:a,width:o,height:i,marginTop:s,marginRight:u,marginBottom:c,marginLeft:d,align:m}=t;if("string"!=typeof r||!r)return null;const{wrapperStyle:b,blockStyle:p}=Q({widthMode:l,displayWidth:a,width:o,height:i,marginTop:s,marginRight:u,marginBottom:c,marginLeft:d,align:m});return e.createElement("div",{className:"p-like"},e.createElement("div",{style:b},e.createElement("div",{style:p},e.createElement(H,{element:t,noFocus:!0,lookupAttribute:n}))))},H=({element:{embedType:t,url:n,src:r,autoPlay:a,controls:o,loop:i,muted:s},noFocus:u,forceMuted:c,lookupAttribute:d})=>{if(!n)return null;const m={width:"100%",height:"100%",frameBorder:"0",allow:"accelerometer; autoplay; fullscreen; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,allowtransparency:"true",mozallowfullscreen:"true",webkitallowfullscreen:"true",oallowfullscreen:"true",msallowfullscreen:"true",style:{display:"block"},tabIndex:u?-1:void 0};if("video"===t)return e.createElement("video",{key:n+";"+String(a)+";"+String(o)+";"+String(i)+";"+String(s),src:n,style:{width:"100%",height:"100%",display:"block"},autoPlay:!!a,controls:!1!==o,loop:i,muted:c||s});if(r){let t;try{t=new URL(r)}catch(w){return null}return c&&(t.searchParams.has("autoplay")||t.searchParams.has("autoPlay"))&&(t.searchParams.set("mute","1"),t.searchParams.set("muted","1"),t.searchParams.set("volume","0")),e.createElement("iframe",{src:t.toString(),...m})}let b=function(e,{iframeFallback:t}={}){let n;try{n=new URL(e)}catch(w){return{kind:"invalid"}}const{hostname:r,pathname:l,searchParams:a}=n;if(r.match(/^(www\.)?(use)?loom\.com$/)){const e=l.match(/^\/share\/([a-z0-9]+)$/i);if(e){const[,t]=e;return{kind:"ok",videoProvider:"loom",videoId:t,searchParams:a}}}if(e.startsWith("raw:")){return{kind:"ok",videoProvider:"raw",videoId:e.replace(/^raw:/,""),searchParams:a}}if(e.startsWith("iframe:")){return{kind:"ok",videoProvider:"iframe",videoId:e.replace(/^iframe:/,""),searchParams:a}}if(["youtube.com","www.youtube.com"].includes(r)){const e=a.get("v");if(e)return a.delete("v"),{kind:"ok",videoProvider:"youtube",videoId:e,searchParams:a}}if("youtu.be"===r){const e=l.match(/^\/([^/]+)$/);if(e){const[,t]=e;return{kind:"ok",videoProvider:"youtube",videoId:t,searchParams:a}}}if("vimeo.com"===r){const e=l.match(/^\/(\d+)$/);if(e){const[,t]=e;return{kind:"ok",videoProvider:"vimeo",videoId:t,searchParams:a}}}if("player.vimeo.com"===r){const e=l.match(/^\/video\/([^/]+)$/);if(e){const[,t]=e;return{kind:"ok",videoProvider:"vimeo",videoId:t,searchParams:a}}}if(r.match(/^[^.]+\.wistia.com$/)){const e=l.match(/^\/medias\/([^/]+)$/);if(e){const[,t]=e;return{kind:"ok",videoProvider:"wistia",videoId:t,searchParams:a}}}return t?{kind:"ok",videoProvider:"iframe",videoId:e,searchParams:a}:{kind:"invalid"}}(n,{iframeFallback:!0});if("invalid"===b.kind)return null;const{videoProvider:p,videoId:h,searchParams:f}=b;switch(a=a||f.has("autoplay")||f.has("autoPlay"),p){case"iframe":return e.createElement("iframe",{src:l(h,(e=>encodeURIComponent((d?d(e):"")||""))),scrolling:f.get("scrolling")||void 0,...m});case"loom":return e.createElement("iframe",{src:`https://www.loom.com/embed/${h}?${f.toString()}`,...m});case"raw":return e.createElement("video",{src:h,controls:!0,style:{width:"100%",height:"100%",display:"block"},autoPlay:f.has("autoplay"),muted:c||f.has("muted")});case"youtube":return c&&a&&f.set("mute","1"),e.createElement("iframe",{src:`https://www.youtube.com/embed/${h}?${f.toString()}`,...m});case"vimeo":return c&&a&&f.set("muted","1"),e.createElement("iframe",{src:`https://player.vimeo.com/video/${h}?${f.toString()}`,...m});case"wistia":return f.set("videoFoam","true"),c&&a&&f.set("volume","0"),e.createElement(e.Fragment,null,e.createElement("iframe",{src:`https://fast.wistia.net/embed/iframe/${h}?${f.toString()}`,...m}))}};function X(e){return"right"===e.align?"userflowjs-text-align-end":"center"===e.align?"userflowjs-text-align-center":"justify"===e.align?"userflowjs-text-align-justify":""}function Q({widthMode:e,displayWidth:t,width:n,height:r,marginTop:l,marginRight:a,marginBottom:o,marginLeft:i,align:s}){const u={position:"relative"};"number"!=typeof t&&(t=100,e="percent"),"center"===s?(u.marginLeft="auto",u.marginRight="auto"):"right"===s&&(u.marginLeft="auto");let c=0;if(null!=l&&"number"==typeof l&&(u.marginTop=`${l}px`),null!=a&&"number"==typeof a&&(u.marginRight=`${a}px`,c+=a),null!=o&&"number"==typeof o&&(u.marginBottom=`${o}px`),null!=i&&"number"==typeof i&&(u.marginLeft=`${i}px`,c+=i),"number"!=typeof t||"number"!=typeof n||"number"!=typeof r)u.width="100px",u.height="100px";else if("px"===e){const e=10,l=Math.max(e,t);u.width=`${l}px`,u.height=l/(n/r)+"px"}else{const e=Math.max(0,Math.min(100,t));u.width=`calc(${e}% - ${c}px)`,u.height="0",u.paddingBottom=`calc((${e}% - ${c}px) / (${n} / ${r})`}return{wrapperStyle:u,blockStyle:{position:"absolute",top:"0",left:"0",display:"block",width:"100%",height:"100%"}}}function Z(e){return{display:"flex",alignItems:"stretch",marginRight:`-${null==e.spacing?16:e.spacing}px`}}function Y(e,t){const n="fill"===e.widthMode||null==e.displayWidth;return{display:"flex",flexDirection:"column",justifyContent:e.justifyContent,width:n?void 0:"px"===e.widthMode?`${e.displayWidth||50}px`:"percent"===e.widthMode?`${e.displayWidth||50}%`:void 0,flex:n?"1 0 0":void 0,marginRight:`${null==t.spacing?16:t.spacing}px`,marginBottom:"0"}}function ee(e){return{display:"flex",flexDirection:"column",justifyContent:e.justifyContent,width:"px"===e.widthMode&&null!=e.displayWidth?`${e.displayWidth}px`:"percent"===e.widthMode&&null!=e.displayWidth?`${e.displayWidth}%`:void 0,minHeight:"px"===e.heightMode?`${e.displayHeight||50}px`:void 0,flex:"fill"===e.heightMode?"1 0 0":void 0,marginTop:null!=e.marginTop?`${e.marginTop}px`:void 0,marginRight:null!=e.marginRight?`${e.marginRight}px`:"fill"!==e.widthMode&&"center"===e.align?"auto":void 0,marginBottom:null!=e.marginBottom?`${e.marginBottom}px`:void 0,marginLeft:null!=e.marginLeft?`${e.marginLeft}px`:"fill"===e.widthMode||"center"!==e.align&&"right"!==e.align?void 0:"auto"}}function te(e,t){if(!t)return null;const n=e.attributeName;if("string"==typeof n){const r=t(n)||e.fallback;if("string"==typeof r)return r}return null}function ne(e){return Array.isArray(e.children)&&void 0===e.addMark}function re(e,t,n="type"){return ne(e)&&e[n]===t}function le(e){return"string"==typeof e.text}function ae(e,t){function n(e){e&&e.forEach(((e,r)=>e&&function(e,r){t(e,r),ne(e)&&n(e.children)}(e,r)))}n(Array.isArray(e)?e:e.children)}const oe=e.memo((({doc:t,lookupAttribute:n})=>t?e.createElement(e.Fragment,null,M(t,{lookupAttribute:n})):null));function ie(e,{buttons:t,questions:n}){const r=new Set,l=new Set;if(ae(e,(e=>{re(e,"button")&&r.add(e.cvid),re(e,"question")&&l.add(e.cvid)})),n){const t=n.filter((e=>!l.has(e.cvid)));t.length>0&&(e={...e,children:[...e.children,...t.map((e=>({type:"question",cvid:e.cvid,children:[{text:""}]})))]})}if(t){const n=t.filter((e=>!r.has(e.cvid)));n.length>0&&(e={...e,children:[...e.children,{type:"button-group",children:n.map((e=>({type:"button",cvid:e.cvid,children:[{text:""}]})))}]})}return e}function se(e){return"userflowjs-bubble-button "+("primary"===(e=e||"default")||"PRIMARY"===e||"default"===e||"DEFAULT"===e||"banner-primary"===e||"banner-secondary"===e?`userflowjs-bubble-button--${e.toLowerCase()}`:e)}var ue=new URL("bubble-frame.css",import.meta.url).href;export{T as B,F as R,k as S,oe as a,ue as b,j as c,R as d,_ as e,te as g,N as h,le as i,ie as m,q as n,O as r,M as s,x as u};
